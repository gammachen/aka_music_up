您遇到的 `concat:` 协议失效问题，根源在于 **FFmpeg 对图像输入的处理机制差异**。以下是详细分析：

---

### **一、两种命令的行为差异分析**

#### **1. 成功案例（序列模式）**
```bash
ffmpeg -framerate 1 -start_number 47 -i "page_%03d.jpg" \
       -vframes 7 -r 1 ... output.mp4
```
- **工作原理**：
  - `-start_number 47` 明确告知 FFmpeg 文件名起始编号
  - `%03d` 通配符匹配 `047, 048,...,053`
  - FFmpeg 自动按顺序读取所有匹配文件
  - `-vframes 7` 限制处理7帧（避免意外读取多余文件）

#### **2. 失败案例（concat协议）**
```bash
ffmpeg -framerate 1 -i "concat:page_047.jpg|page_048.jpg|..." \
       -r 1 ... output.mp4
```
- **问题本质**：
  - `concat:` 协议设计初衷是拼接 **连续媒体流**（如视频片段）
  - 对 **离散图像文件** 的支持存在限制：
    - 默认每张图片被视为独立的媒体流
    - 未明确指定时，FFmpeg 可能只读取第一个输入流

---

### **二、为什么 `concat:` 协议会失败？**

#### **1. 协议行为差异**
| 参数               | 序列模式 (`%03d`)       | `concat:` 协议          |
|--------------------|------------------------|------------------------|
| **输入类型**       | 图像序列               | 任意媒体文件           |
| **流连续性**       | 自动合并为单一流       | 每个文件视为独立流     |
| **默认帧处理**     | 按文件名顺序逐帧读取   | 可能仅取第一个输入流   |

#### **2. 核心矛盾点**
- **流选择规则**：  
  当输入包含多个流时，FFmpeg 默认选择每个文件的第一个流（通常是视频流）。由于每个 JPG 文件都被视为独立输入，最终只保留第一个文件的流。
  
- **无连续性保证**：  
  `concat:` 协议需要显式指定流拼接方式，而图像模式下缺乏自动串联机制。

---

### **三、解决方案：正确使用 `concat` 协议**

#### **1. 显式指定输入格式**
```bash
ffmpeg -f image2 -framerate 1 -i "concat:page_047.jpg|page_048.jpg|..." \
       -r 1 ... output.mp4
```
- **改进点**：  
  添加 `-f image2` 强制指定输入为图像序列格式，促使 FFmpeg 将所有文件合并为单一流。

#### **2. 使用 `concat` 滤镜（更可靠）**
```bash
ffmpeg -framerate 1 -i page_047.jpg -framerate 1 -i page_048.jpg ... \
       -filter_complex "[0][1][2][3][4][5][6]concat=n=7:v=1:a=0" \
       -r 1 ... output.mp4
```
- **优势**：  
  明确拼接7个输入流，确保所有图片被处理。

#### **3. 生成文件列表（最佳实践）**
```bash
# 创建列表文件
echo -e "file 'page_047.jpg'\nduration 1\nfile 'page_048.jpg'\nduration 1\n..." > list.txt

# 转换命令
ffmpeg -f concat -safe 0 -i list.txt -r 1 ... output.mp4
```
- **特点**：  
  - 完全兼容所有文件名格式  
  - 可精确控制每张图片的显示时长

---

### **四、验证命令有效性**
使用以下命令检查输出视频的帧数：
```bash
ffprobe -v error -count_frames -select_streams v:0 \
        -show_entries stream=nb_read_frames -of csv=p=0 output.mp4
```
- **预期输出**：`7`（对应7张图片）

---

### **五、总结：协议选择建议**
| 场景               | 推荐方法               | 优点                   |
|--------------------|------------------------|------------------------|
| **连续编号图片**   | 序列模式 (`%03d`)      | 简洁高效               |
| **非连续/混合文件**| 文件列表 (`-f concat`) | 灵活可靠               |
| **精确控制时长**   | `concat` 滤镜          | 可定制每帧时长         |

通过正确理解协议差异，选择最适合当前文件组织方式的命令，即可避免类似问题。

