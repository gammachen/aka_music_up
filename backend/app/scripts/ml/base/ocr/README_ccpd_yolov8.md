# CCPD数据集与YOLOv8车牌检测训练指南

本文档提供了使用CCPD（Chinese City Parking Dataset）数据集训练YOLOv8模型进行车牌检测的详细说明。

## 数据集说明

CCPD是全球最大的中文车牌数据集，其特点是将标注信息编码在文件名中。例如：

```
025-95_113-154&383_386&473-386&473_177&454_154&383_363&402-0_0_22_27_27_33_16-37-15.jpg
```

文件名各部分含义：
1. `025`：车牌区域占整个画面的比例
2. `95_113`：车牌水平和垂直角度，水平95°，竖直113°
3. `154&383_386&473`：标注框左上、右下坐标，左上(154, 383)，右下(386, 473)
4. `386&473_177&454_154&383_363&402`：标注框四个角点坐标，顺序为右下、左下、左上、右上
5. `0_0_22_27_27_33_16`：车牌号码映射，解析后为"皖AY339S"
   - 第一个0：省份，对应"皖"
   - 第二个0：地市代码，对应"A"
   - 后5位：字母和数字，对应"Y339S"

## 脚本功能

`train_ccpd_yolov8.py`脚本实现以下功能：

1. 解析CCPD数据集文件名，提取车牌位置和车牌号码
2. 将数据转换为YOLO格式（归一化坐标的边界框）
3. 自动划分训练集、验证集和测试集（如果数据集未预先划分）
4. 使用YOLOv8训练车牌检测模型
5. 验证模型性能并在测试图像上进行演示

## 使用方法

### 环境准备

确保已安装以下依赖：

```bash
pip install ultralytics opencv-python numpy tqdm pyyaml
```

### 数据集准备

将CCPD数据集下载并解压到指定位置。默认路径为：
```
/User/shhaofu/Downlowds/CCPD2020/ccpd_green
```

如需修改路径，请编辑脚本中的`CCPD_ROOT`变量。

### 运行训练

```bash
python train_ccpd_yolov8.py
```

脚本将自动：
1. 准备数据集（解析文件名并转换为YOLO格式）
2. 训练YOLOv8模型
3. 验证模型性能
4. 在测试图像上展示结果

### 输出文件

- `ccpd_yolo_dataset/`：转换后的YOLO格式数据集
- `ccpd_yolo_runs/`：训练过程中的日志和中间结果
- `best.pt`：训练得到的最佳模型

## 参数调整

可以根据需要调整以下参数：

- `TRAIN_RATIO`, `VAL_RATIO`, `TEST_RATIO`：数据集划分比例
- 训练参数：
  - `epochs`：训练轮次，默认100
  - `imgsz`：图像大小，默认640
  - `batch`：批次大小，默认16
  - `patience`：早停耐心值，默认15

## 注意事项

1. 训练过程需要GPU加速，请确保系统有可用的CUDA环境
2. 对于大型数据集，处理和训练可能需要较长时间
3. 如果内存不足，可以减小批次大小（batch）
4. 如果数据集已经预先划分为train/val/test目录，脚本会自动使用这种划分

## 模型应用

训练完成后，可以使用以下代码在新图像上进行车牌检测：

```python
from ultralytics import YOLO

# 加载训练好的模型
model = YOLO('best.pt')

# 在图像上进行预测
results = model('path/to/image.jpg')

# 显示结果
results[0].show()
```