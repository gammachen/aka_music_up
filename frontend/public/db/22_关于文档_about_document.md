编写文档

世上没有能够代替文档的代码。尽管一个资深的开发人员能够通过仔细的分析以及凭借自己 丰富的经验来解读一段代码，但依旧是非常消耗体力的1。同时，代码也不能告诉你还有哪些问 题没解决。
你应该将数据库的需求和实现也写成文档，就像对待程序代码那样。无论你是数据库的原始 设计者，还是从别人那里接手的数据库，尽可能地使用下面的清单来检查文档的完整性。
实体关系图。整份数据库文档中最重要的部分，就是一张描述了数据库中所有表及表之间关系的 ER 图。本书有几章中使用了简单的 ER 图。更复杂一点的 ER 图包含了列、主键、索引和其 他数据库对象。
不少绘图软件包含了 ER 图的标记。还有些工具能够通过 SQL 脚本或者运行中的数据库 直接通过反向工程得到 ER 图。
当数据库过于复杂，表特别多时，要在一张 ER 图中将所有条目都表示出来会有点不切 实际。在这种情况下，你应该将其拆分到多张图中。通常你可以使用“子组”这个符号，这 样一来，ER 图中即包含了足够的阅读信息，也不至于让人看得晕头转向。
表、列以及视图。你仍需要为数据库编写文档，因为 ER 图不是描述每张表、列及其他对象的目 的和使用方法的正确形式。
对于表来说，需要描述一张表代表了哪种实体类型。比如 Bugs、Products 和 Accounts 很容易就能根据表名看出它们的意思，但对于 BugStatus 这种查询表，或者 BugsProducts 这种交叉表，又或者 Comments 这种依赖表来说，很难从表名上看出它们的作用。同时， 还需要说明每张表预期存储多少行数据?你希望如何对这张表进行查询?表中有哪些索 引?
每个列都有一个列名和对应的数据类型，但这些信息并不能说清楚这个列所代表的含 义。比如说，哪些值对于这一列是有意义的(只有很少的情况下，取值范围是对应数据类型 的所有可选值的全集)?这个列能否接受 NULL，为什么?有没有针对这一列的唯一性约束? 如果有，为什么要有?
视图存储了对于一张或多张表的常用查询结果。为什么需要创建这样一个视图?哪个产 品或者用户需要使用这个视图?这个视图是不是试图提取表之间的复杂关系?这个视图会 不会让没有权限的用户查询一张需要授权的表的部分数据?这个视图是否可以更新?

关系。引用完整性约束表示了表和表之间的依赖关系，但可能并没有完整表达出你所设计的约束 模型。比如，Bugs.reported_by 是非空的，但 Bugs.assigned_to 是可空的。这是不是意 味着一个 Bug 可以在指派给任何人之前就被修复?如果不是，一个 Bug 的指派应该要遵循 什么样的规则?
在某些情况下，可能存在一些隐式关系，但没有任何相关的约束。如果没有文档，别人 很难知道存在这些关系。
触发器。数据验证、数据转换以及记录数据库变更，都是使用触发器的场景。你在触发器中实现 了怎样的业务逻辑?这些都是需要记录在文档中的。
存储过程。要像 API 那样为存储过程编写文档。这个存储过程要解决什么问题?这个存储过程是 否会改变数据?输入输出参数的类型和意义是什么?是否使用这个存储过程来替换一种查 询请求，就能够解决某个性能瓶颈?使用这个存储过程是否会让没有权限的用户访问到需要 权限的表?
SQL 安全。为应用程序指定了哪个数据库用户账号?每个用户都有哪些访问权限?你提供了哪 些 SQL 任务，哪些用户可以使用这些任务?是否有些用户是为了特殊的任务所定义的，比 如备份或报表?使用哪种系统安全级别规定，比如客户端必须通过 SSL 和 RDBMS 服务器端 链接吗?使用何种机制检测和屏蔽非法的认证请求，比如暴力破解密码?有没有针对 SQL 注入做过一次完整的代码审查?
数据库基础设施:这些信息对运维和 DBA 的同事来说是最重要的，但开发人员最好也对此有些 了解。使用哪个厂商的哪个版本的 RDBMS 服务?数据库服务器的主机名是什么?是否使用 了多台数据库服务器、冗余备份、服务器集群、访问代理等?网络结构是什么样的?数据库 服务器使用的是什么端口?客户端程序连接的时候有什么特殊的选项?数据库的用户密码 是什么?数据库的备份方案是什么?
ORM。你的项目可能将一部分应由数据库处理的逻辑写在了程序代码中，作为基于 ORM 类的 层的一部分。哪些业务逻辑是以这样的方式实现的?数据验证、数据转换、日志、缓存还 是配置?
开发人员不喜欢维护工程文档。它们既难以编写，也很难保持实时更新，而且当你写了 很多却少有人读的时候，会感到很失落。但即使是经验丰富或者极限编程的程序员也知道， 他们可以不为程序的其他部分写文档，但一定要编写数据库部分的文档1。

