mysql> EXPLAIN SELECT A.* FROM A;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |   100.00 | NULL  |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.* FROM A WHERE A.a1=1;
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref   | rows | filtered | Extra |
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------+
|  1 | SIMPLE      | A     | NULL       | const | a1,index_of_a_a1 | a1   | 5       | const |    1 |   100.00 | NULL  |
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.* FROM A WHERE -A.a1=-2;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |   100.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1=1;
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref   | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | const | a1,index_of_a_a1 | a1   | 5       | const |    1 |   100.00 | Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+-------+------+----------+-------------+
1 row in set, 1 warning (0.02 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a3=1;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |    10.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1=1 AND A.a3=1;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------------------------------------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                               |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------------------------------------------+
|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | Impossible WHERE noticed after reading const tables |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-----------------------------------------------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.* FROM A WHERE A.a1+A.a3=2;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |   100.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.* FROM A WHERE A.a1=2-A.a3;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |    10.00 | Using where |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)

mysql>  EXPLAIN SELECT A.a1 FROM A WHERE A.a1<1+2;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | A     | NULL       | range | a1,index_of_a_a1 | a1   | 5       | NULL |    2 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1>1;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | A     | NULL       | range | a1,index_of_a_a1 | a1   | 5       | NULL |  999 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1<1;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | A     | NULL       | range | a1,index_of_a_a1 | a1   | 5       | NULL |    1 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1<>1;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | A     | NULL       | index | a1,index_of_a_a1 | a1   | 5       | NULL | 1000 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE A.a1 BETWEEN 1 AND 2;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | A     | NULL       | range | a1,index_of_a_a1 | a1   | 5       | NULL |    2 |   100.00 | Using where; Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.00 sec)

mysql> CREATE TABLE B (b1 INT UNIQUE, b2 VARCHAR(9), c2 INT);
Query OK, 0 rows affected (0.13 sec)

mysql> EXPLAIN SELECT A.*, B.* FROM A JOIN B ON (a1=b1);
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
| id | select_type | table | partitions | type   | possible_keys    | key  | key_len | ref               | rows | filtered | Extra       |
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
|  1 | SIMPLE      | B     | NULL       | ALL    | b1               | NULL | NULL    | NULL              |    1 |   100.00 | Using where |
|  1 | SIMPLE      | A     | NULL       | eq_ref | a1,index_of_a_a1 | a1   | 5       | pperformance.B.b1 |    1 |   100.00 | NULL        |
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
2 rows in set, 1 warning (0.03 sec)

mysql> SET @i = 0;
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO B (b1, b2, b3)
    -> SELECT
    ->     (@i := @i + 1) AS a1,          --
    ->     CONCAT('user', LPAD(@i, 3, '0')) AS a2,  --  user001
    ->     FLOOR(RAND() * 1000) AS a3      -- 0-999
    -> FROM information_schema.columns     --
    -> LIMIT 1000;                         -- 1000
ERROR 1054 (42S22): Unknown column 'b3' in 'field list'
mysql> SET @i = 0;
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO B (b1, b2, c2)
    -> SELECT
    ->     (@i := @i + 1) AS a1,          --
    ->     CONCAT('user', LPAD(@i, 3, '0')) AS a2,  --  user001
    ->     FLOOR(RAND() * 1000) AS a3      -- 0-999
    -> FROM information_schema.columns     --
    -> LIMIT 1000;                         -- 1000
Query OK, 1000 rows affected, 1 warning (0.10 sec)
Records: 1000  Duplicates: 0  Warnings: 1

mysql> EXPLAIN SELECT A.*, B.* FROM A JOIN B ON (a1=b1);
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
| id | select_type | table | partitions | type   | possible_keys    | key  | key_len | ref               | rows | filtered | Extra       |
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | ALL    | a1,index_of_a_a1 | NULL | NULL    | NULL              | 1000 |   100.00 | Using where |
|  1 | SIMPLE      | B     | NULL       | eq_ref | b1               | b1   | 5       | pperformance.A.a1 |    1 |   100.00 | NULL        |
+----+-------------+-------+------------+--------+------------------+------+---------+-------------------+------+----------+-------------+
2 rows in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.a1 FROM A GROUP BY a1;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | index | a1,index_of_a_a1 | a1   | 5       | NULL | 1000 |   100.00 | Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.03 sec)

mysql> EXPLAIN SELECT A.* FROM A ORDER BY a1;
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
|  1 | SIMPLE      | A     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1000 |   100.00 | Using filesort |
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT A.a1 FROM A WHERE a3>2 GROUP BY a1 HAVING a1>2;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | index | a1,index_of_a_a1 | a1   | 5       | NULL | 1000 |    33.33 | Using where |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)

mysql> EXPLAIN SELECT DISTINCT A.a1 FROM A;
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys    | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | A     | NULL       | index | a1,index_of_a_a1 | a1   | 5       | NULL | 1000 |   100.00 | Using index |
+----+-------------+-------+------------+-------+------------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.01 sec)
# SQL 执行计划分析

## 1. 简单查询
### 1.1 `EXPLAIN SELECT A.* FROM A;`
- **结果**: `type=ALL`, `key=NULL`
- **分析**: 全表扫描，未使用索引。
- **原因**: 查询未指定任何条件，因此无法使用索引。

### 1.2 `EXPLAIN SELECT A.* FROM A WHERE A.a1=1;`
- **结果**: `type=const`, `key=a1`
- **分析**: 使用了 `a1` 索引，查询类型为 `const`。
- **原因**: 查询条件中使用了 `a1` 字段，且该字段有索引，因此命中了索引。

## 2. 复杂条件查询
### 2.1 `EXPLAIN SELECT A.* FROM A WHERE -A.a1=-2;`
- **结果**: `type=ALL`, `key=NULL`
- **分析**: 全表扫描，未使用索引。
- **原因**: 查询条件中使用了表达式 `-A.a1=-2`，MySQL 无法直接使用索引。

### 2.2 `EXPLAIN SELECT A.a1 FROM A WHERE A.a1=1 AND A.a3=1;`
- **结果**: `type=NULL`, `key=NULL`
- **分析**: 查询结果为 `Impossible WHERE`，未使用索引。
- **原因**: 查询条件中 `A.a1=1` 和 `A.a3=1` 无法同时满足，因此 MySQL 认为这是一个不可能的条件。

## 3. 索引使用情况
### 3.1 `EXPLAIN SELECT A.a1 FROM A WHERE A.a1<1+2;`
- **结果**: `type=range`, `key=a1`
- **分析**: 使用了 `a1` 索引，查询类型为 `range`。
- **原因**: 查询条件中使用了范围查询 `A.a1<1+2`，因此命中了 `a1` 索引。

### 3.2 `EXPLAIN SELECT A.a1 FROM A WHERE A.a1 BETWEEN 1 AND 2;`
- **结果**: `type=range`, `key=a1`
- **分析**: 使用了 `a1` 索引，查询类型为 `range`。
- **原因**: 查询条件中使用了 `BETWEEN` 范围查询，因此命中了 `a1` 索引。

## 4. 连接查询
### 4.1 `EXPLAIN SELECT A.*, B.* FROM A JOIN B ON (a1=b1);`
- **结果**: `type=eq_ref`, `key=a1`
- **分析**: 使用了 `a1` 索引，查询类型为 `eq_ref`。
- **原因**: 连接条件中使用了 `a1=b1`，且 `a1` 和 `b1` 都有索引，因此命中了索引。

## 5. 分组与排序
### 5.1 `EXPLAIN SELECT A.a1 FROM A GROUP BY a1;`
- **结果**: `type=index`, `key=a1`
- **分析**: 使用了 `a1` 索引，查询类型为 `index`。
- **原因**: 查询中使用了 `GROUP BY a1`，因此命中了 `a1` 索引。

### 5.2 `EXPLAIN SELECT A.* FROM A ORDER BY a1;`
- **结果**: `type=ALL`, `key=NULL`, `Extra=Using filesort`
- **分析**: 全表扫描，未使用索引，使用了文件排序。
- **原因**: 查询中使用了 `ORDER BY a1`，但未使用索引，因此 MySQL 使用了文件排序。

## 6. 总结
- **索引命中情况**: 当查询条件中使用了索引字段，且条件为等值查询或范围查询时，通常会命中索引。
- **未命中索引情况**: 当查询条件中使用了表达式、复杂条件或未使用索引字段时，通常不会命中索引。
- **查询类型**: `const` 表示常量查询，`eq_ref` 表示唯一索引查询，`range` 表示范围查询，`index` 表示索引扫描，`ALL` 表示全表扫描。
- **额外信息**: `Using where` 表示使用了 `WHERE` 条件，`Using index` 表示使用了覆盖索引，`Using filesort` 表示使用了文件排序。
