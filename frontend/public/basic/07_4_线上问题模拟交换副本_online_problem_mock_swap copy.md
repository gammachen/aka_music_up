
bash 1_run_allocate_memory_script.sh
or
python memory_eater.py

(base) shaofu@shaofu:~$ python memory_eater.py
Starting memory hog process...
WARNING: This will consume all available memory and Swap space.
Run this only in a controlled environment (e.g., VM).
Allocated 50 MB, Total: 1 chunks
Allocated 100 MB, Total: 2 chunks
Allocated 150 MB, Total: 3 chunks
Allocated 200 MB, Total: 4 chunks
Allocated 250 MB, Total: 5 chunks
Allocated 300 MB, Total: 6 chunks
Allocated 350 MB, Total: 7 chunks
Allocated 400 MB, Total: 8 chunks
Allocated 450 MB, Total: 9 chunks
Allocated 500 MB, Total: 10 chunks
Allocated 550 MB, Total: 11 chunks
Allocated 600 MB, Total: 12 chunks
Allocated 650 MB, Total: 13 chunks
Allocated 700 MB, Total: 14 chunks
Allocated 750 MB, Total: 15 chunks
Allocated 800 MB, Total: 16 chunks
Allocated 850 MB, Total: 17 chunks
Allocated 900 MB, Total: 18 chunks
Allocated 950 MB, Total: 19 chunks
Allocated 1000 MB, Total: 20 chunks
Allocated 1050 MB, Total: 21 chunks
Allocated 1100 MB, Total: 22 chunks
Allocated 1150 MB, Total: 23 chunks
Allocated 1200 MB, Total: 24 chunks
Allocated 1250 MB, Total: 25 chunks
Allocated 1300 MB, Total: 26 chunks
Allocated 1350 MB, Total: 27 chunks
Allocated 1400 MB, Total: 28 chunks
Allocated 1450 MB, Total: 29 chunks
Allocated 1500 MB, Total: 30 chunks
Allocated 1550 MB, Total: 31 chunks
Allocated 1600 MB, Total: 32 chunks
Allocated 1650 MB, Total: 33 chunks
Allocated 1700 MB, Total: 34 chunks
Allocated 1750 MB, Total: 35 chunks
Allocated 1800 MB, Total: 36 chunks
Allocated 1850 MB, Total: 37 chunks
Allocated 1900 MB, Total: 38 chunks
Allocated 1950 MB, Total: 39 chunks
Allocated 2000 MB, Total: 40 chunks
Allocated 2050 MB, Total: 41 chunks
Allocated 2100 MB, Total: 42 chunks
Allocated 2150 MB, Total: 43 chunks
Allocated 2200 MB, Total: 44 chunks
Allocated 2250 MB, Total: 45 chunks
Allocated 2300 MB, Total: 46 chunks
Allocated 2350 MB, Total: 47 chunks
Allocated 2400 MB, Total: 48 chunks
Allocated 2450 MB, Total: 49 chunks
Allocated 2500 MB, Total: 50 chunks
Allocated 2550 MB, Total: 51 chunks
Allocated 2600 MB, Total: 52 chunks
Allocated 2650 MB, Total: 53 chunks
Allocated 2700 MB, Total: 54 chunks
Allocated 2750 MB, Total: 55 chunks
Allocated 2800 MB, Total: 56 chunks
Allocated 2850 MB, Total: 57 chunks
Allocated 2900 MB, Total: 58 chunks
Allocated 2950 MB, Total: 59 chunks
Allocated 3000 MB, Total: 60 chunks
Allocated 3050 MB, Total: 61 chunks
Allocated 3100 MB, Total: 62 chunks
Allocated 3150 MB, Total: 63 chunks
Allocated 3200 MB, Total: 64 chunks
Allocated 3250 MB, Total: 65 chunks
Allocated 3300 MB, Total: 66 chunks
Allocated 3350 MB, Total: 67 chunks
Allocated 3400 MB, Total: 68 chunks
Allocated 3450 MB, Total: 69 chunks
Allocated 3500 MB, Total: 70 chunks
Allocated 3550 MB, Total: 71 chunks
Allocated 3600 MB, Total: 72 chunks
Allocated 3650 MB, Total: 73 chunks
Allocated 3700 MB, Total: 74 chunks
Allocated 3750 MB, Total: 75 chunks
Allocated 3800 MB, Total: 76 chunks
Allocated 3850 MB, Total: 77 chunks
Allocated 3900 MB, Total: 78 chunks
Allocated 3950 MB, Total: 79 chunks
Allocated 4000 MB, Total: 80 chunks
Allocated 4050 MB, Total: 81 chunks
Allocated 4100 MB, Total: 82 chunks
Allocated 4150 MB, Total: 83 chunks
Allocated 4200 MB, Total: 84 chunks
Allocated 4250 MB, Total: 85 chunks
Allocated 4300 MB, Total: 86 chunks
Allocated 4350 MB, Total: 87 chunks
Allocated 4400 MB, Total: 88 chunks
Allocated 4450 MB, Total: 89 chunks
Allocated 4500 MB, Total: 90 chunks
Allocated 4550 MB, Total: 91 chunks
Allocated 4600 MB, Total: 92 chunks
Allocated 4650 MB, Total: 93 chunks
Allocated 4700 MB, Total: 94 chunks
Allocated 4750 MB, Total: 95 chunks
Allocated 4800 MB, Total: 96 chunks
Allocated 4850 MB, Total: 97 chunks
Allocated 4900 MB, Total: 98 chunks
Allocated 4950 MB, Total: 99 chunks
Allocated 5000 MB, Total: 100 chunks
Allocated 5050 MB, Total: 101 chunks
Allocated 5100 MB, Total: 102 chunks
Allocated 5150 MB, Total: 103 chunks
Allocated 5200 MB, Total: 104 chunks
Allocated 5250 MB, Total: 105 chunks
Allocated 5300 MB, Total: 106 chunks
Allocated 5350 MB, Total: 107 chunks
Allocated 5400 MB, Total: 108 chunks
Allocated 5450 MB, Total: 109 chunks
Allocated 5500 MB, Total: 110 chunks
Allocated 5550 MB, Total: 111 chunks
Allocated 5600 MB, Total: 112 chunks
Allocated 5650 MB, Total: 113 chunks
Allocated 5700 MB, Total: 114 chunks
Allocated 5750 MB, Total: 115 chunks
Allocated 5800 MB, Total: 116 chunks
Allocated 5850 MB, Total: 117 chunks
Allocated 5900 MB, Total: 118 chunks
Allocated 5950 MB, Total: 119 chunks
Allocated 6000 MB, Total: 120 chunks
Allocated 6050 MB, Total: 121 chunks
Allocated 6100 MB, Total: 122 chunks
Allocated 6150 MB, Total: 123 chunks
Allocated 6200 MB, Total: 124 chunks
Allocated 6250 MB, Total: 125 chunks
Allocated 6300 MB, Total: 126 chunks
Allocated 6350 MB, Total: 127 chunks
Allocated 6400 MB, Total: 128 chunks
Allocated 6450 MB, Total: 129 chunks
Allocated 6500 MB, Total: 130 chunks
Allocated 6550 MB, Total: 131 chunks
Allocated 6600 MB, Total: 132 chunks
Allocated 6650 MB, Total: 133 chunks
Allocated 6700 MB, Total: 134 chunks
Allocated 6750 MB, Total: 135 chunks
Allocated 6800 MB, Total: 136 chunks
Allocated 6850 MB, Total: 137 chunks
Allocated 6900 MB, Total: 138 chunks
Allocated 6950 MB, Total: 139 chunks
Allocated 7000 MB, Total: 140 chunks
Allocated 7050 MB, Total: 141 chunks
Allocated 7100 MB, Total: 142 chunks
Allocated 7150 MB, Total: 143 chunks
Allocated 7200 MB, Total: 144 chunks
Allocated 7250 MB, Total: 145 chunks
Allocated 7300 MB, Total: 146 chunks
Allocated 7350 MB, Total: 147 chunks
Allocated 7400 MB, Total: 148 chunks
Allocated 7450 MB, Total: 149 chunks
Allocated 7500 MB, Total: 150 chunks
Allocated 7550 MB, Total: 151 chunks
Allocated 7600 MB, Total: 152 chunks
Allocated 7650 MB, Total: 153 chunks
Allocated 7700 MB, Total: 154 chunks
Allocated 7750 MB, Total: 155 chunks
Allocated 7800 MB, Total: 156 chunks
Allocated 7850 MB, Total: 157 chunks
Allocated 7900 MB, Total: 158 chunks
Allocated 7950 MB, Total: 159 chunks
Allocated 8000 MB, Total: 160 chunks
Allocated 8050 MB, Total: 161 chunks
Allocated 8100 MB, Total: 162 chunks
Allocated 8150 MB, Total: 163 chunks
Allocated 8200 MB, Total: 164 chunks
Allocated 8250 MB, Total: 165 chunks
Allocated 8300 MB, Total: 166 chunks
Allocated 8350 MB, Total: 167 chunks
Allocated 8400 MB, Total: 168 chunks
Allocated 8450 MB, Total: 169 chunks
Allocated 8500 MB, Total: 170 chunks
Allocated 8550 MB, Total: 171 chunks
Allocated 8600 MB, Total: 172 chunks
Allocated 8650 MB, Total: 173 chunks
Allocated 8700 MB, Total: 174 chunks

已杀死

观测到的内存使用情况：
```bash
watch -n 1 "free -h && grep -i 'swap' /proc/meminfo"

Every 1.0s: free -h && grep -i 'swap' /proc/meminfo                                                                                                                        shaofu: Thu Apr 24 11:45:48 2025

               total        used        free      shared  buff/cache   available
内存：      7.6Gi       1.3Gi       6.1Gi        34Mi       289Mi       6.1Gi
交换：      2.0Gi       271Mi       1.7Gi
SwapCached:        15024 kB
SwapTotal:       2097148 kB
SwapFree:        1818896 kB
Zswap:                 0 kB
Zswapped:              0 kB
```
![2](record_py_watch_swap.gif)


通过slabtop观测到的虚拟内存使用情况：
```bash
sudo watch -n 1 "slabtop -o"
```
![2](record_py_watch_slabtop.gif)

通过top感测内存等使用情况：
```bash
top
```
![3](record_top_swap.gif)

通过vmstat命令来观察内存的使用情况：
```bash
vmstat -t 1 1000
```
![3](record_vmstat_swap.gif)

构建一个逐步创建内存的程序，用来观察内存的使用情况：
```bash
import sys
import time

def memory_hog():
    """
    持续分配内存，直到物理内存耗尽，触发Swap空间使用。
    """
    data = []  # 存储大对象的列表
    chunk_size = 50 * 1024 * 1024  # 每次分配1MB（字节）

    while True:
        try:
            # 创建一个1MB的字节对象
            byte_array = bytearray(chunk_size)
            data.append(byte_array)

            # 打印当前内存使用情况
            # current_usage = sys.getsizeof(data) // (1024 * 1024)
            current_usage = len(data) * chunk_size // (1024 * 1024)
            print(f"Allocated {current_usage} MB, Total: {len(data)} chunks")

            # 每秒检查一次内存
            time.sleep(1)
        except MemoryError:
            print("MemoryError: Out of memory! Continuing...")
            time.sleep(1)
            continue

if __name__ == "__main__":
    print("Starting memory hog process...")
    print("WARNING: This will consume all available memory and Swap space.")
    print("Run this only in a controlled environment (e.g., VM).")
    memory_hog()
```

