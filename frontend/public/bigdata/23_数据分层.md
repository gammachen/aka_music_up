下面是对 `23_数据分层.md` 的内容进行结构化、分层整理和排版优化后的建议。内容未删减，仅做了分节、标题、列表、缩进、分段和部分小标题补充，使其更易读、更清晰：

---

# 中台数据体系特征

- **覆盖全域数据**：数据集中建设，覆盖所有业务过程数据，业务在中台数据体系中总能找到需要的数据。
- **结构层次清晰**：纵向的数据分层，横向主题域、业务过程划分，让整个层次结构清晰易理解。
- **数据准确一致**：定义一致性指标，统一命名、统一业务含义、统一计算口径，并有专业团队负责建模，保证数据的准确一致。
- **降低成本，共享复用**：数据体系的建设使得数据能被业务共享，避免大量烟囱式的重复建设，节约计算、存储和人力成本。
- **方便易用**：越往后越能方便地直接使用数据，把一些复杂的处理尽可能前置，必要时做适当的冗余处理。通过维度冗余和事实冗余提前处理，避免使用时才计算。统一数据体系让整个企业的业务都有机会使用数据。
- **性能提升**：统一的规划设计，选用合理的数据模型，清晰地定义并统一规范，并且考虑使用场景，使整体性能更好。

> 为了使数据体系在建设时具备以上特征，需要一个体系化的数据层次架构，这个层次架构定义了数据分层及每一层的模型建设规范。数据体系架构是一套指导规范，实施过程中应严格按照架构执行。

---

# 数据分层架构

## 1. 源数据层 ODS（Operational Data Store，操作数据层）

- 对各业务系统数据进行采集、汇聚，尽可能保留原始业务流程数据，与业务系统基本保持一致，仅做简单整合、非结构化数据结构化处理或增加标识数据日期描述信息，不做深度清洗加工。

### 源数据层建设 ODS——全域数据统一存储

- 汇聚企业各业务系统数据，保留全量业务原始数据，作为统一数仓层建设的数据源。
- 数据类型分为三类：
  - **结构化数据**：主要是关系型数据库中的数据，直接从业务系统DB抽取。
  - **半结构化数据**：如日志数据，保留原始数据同时做结构化处理，常见如JSON、XML等。
  - **非结构化数据**：如图片、音频、视频，通常只保留描述信息（地址、名称、类型、分辨率等）。

#### 源数据表设计规范

- 表命名采用前缀+业务系统表名，如 `ODS_系统简称_业务系统表名`。
- 字段名与业务系统字段名保持一致，类型尽量一致。
- 对于大表，增量同步时建立增量表和全量表，增量表用后缀标识。
- 日志、文件等半结构化数据需结构化处理，原始数据可按行存储在文本类型大字段中，再解析到结构化表中。

---

## 2. 统一数仓层 DW（Data Warehouse）

- 细分为明细数据层 DWD（Data Warehouse Detail）和汇总数据层 DWS（Data Warehouse Summary）。
- 对全历史业务过程数据进行建模存储，重新组织数据，定义一致的指标、维度，各业务板块、业务域按照统一规范独立建设，形成统一规范的标准业务数据体系。

### 统一数仓层建设 DW——标准化的数据底座

- 站在业务视角，不考虑业务系统流程，从业务完整性角度重新组织数据。
- 目标：建设一套覆盖全域、全历史的企业数据体系，可还原企业任意时刻的业务运转状态。
- 建模方法：可用范式建模、维度建模、实体建模，推荐维度建模。

#### 数据域划分与主题域

1. **调研阶段**
   - 业务调研：确定业务领域、业务线、业务模块、业务流程、业务边界、专业术语。
   - 数据调研：梳理数据流与业务过程关联关系。
2. **业务分类阶段**
   - 业务过程提取与拆分：将业务过程拆分为不可分割的行为事件。
   - 业务过程分类：相似特征的业务过程归为一类，每个过程唯一归属。
3. **数据域定义阶段**
   - 业务分类确认，数据域定义与命名。
4. **总线矩阵构建阶段**
   - 明确每个数据域下的业务过程及其与维度的关系，构建二维矩阵记录。

#### 指标设计

- 指标是在企业业务运转过程中产生的度量事实。
- 一致性指标设计：命名、计算方法、业务理解一致，避免不同部门对同一指标理解不一致。
- 指标定义包括：原子指标、修饰词、时间周期、派生指标的含义、类型、命名、算法。

---

## 3. 标签数据层 TDM（Tag Data Model）

- 面向对象建模，对跨业务板块、跨数据域的特定对象数据进行整合，通过ID-Mapping打通同一对象的数据，形成全域标签体系，方便深度分析、挖掘、应用。

---

## 4. 应用数据层 ADS（Application Data Store）

- 按业务需要从统一数仓层、标签数据层抽取数据，并面向业务的特殊需要加工业务特定数据，以满足业务及性能需求，向特定应用组装应用数据。

---

# 维度建模

## 特点

- **模型简单易理解**：仅有维度、事实两种类型数据，站在业务角度组织数据。
- **性能好**：标准框架，允许数据库和用户通过查询工具生成强大的假设条件。
- **可扩展性好**：可方便增加新的分析维度和事实，不需重载数据或重新编码。
- **数据冗余**：大量预处理导致数据冗余，业务变化时需重新定义维度和预处理。

## 维度表设计

- 维度表包含事实表所记录业务过程度量的上下文和环境，通常包含5W等信息和描述属性字段。
- 每个维度表都包含单一主键列。
- 维度属性是查询约束条件、分组、报表标签的基本来源。
- 维度表通常较宽，包含大量细粒度文本属性，实际应用中几十甚至上百个属性很常见。
- 维度表应尽可能包括有意义的文字性描述，方便下游用户使用。
- 维度属性设计中可有反规范化设计，合并相关维度属性到主维度属性中，达到易用、少关联的效果。

### 维度表设计主要过程

1. 选择维度：可从报表需求或与业务人员交谈中获取。
2. 确定主维表：主维表一般直接从业务系统同步，是分析事实时所需环境描述的最基础、最频繁的维度属性集合。
3. 梳理关联维表：确定哪些表和主维表有关，选择部分表用于生成维度属性。
4. 定义维度属性：尽量生成更丰富、更通用的维度属性。

---

# 事实表设计

- 事实表是统一数仓层建设的主要产出物，绝大部分表都是事实表。
- 由主键和外键组成的键值部分，以及描述业务过程的事实度量部分组成。
- 外键总是对应某个维度表的主键。为提升易用性和性能，事实表可冗余关键维度属性。
- 一切数据应用和分析都围绕事实表展开，稳定的数据模型能大幅提高数据复用性。

## Kimball 维度建模理论中的三种事实表

1. **事务事实表**：描述业务过程事务层面的事实，每条记录代表一个事务事件，数据粒度最细，通常增量更新。
2. **周期快照事实表**：以规律性时间间隔产生快照，记录周期内聚集事实值或状态度量，通常增量更新。
3. **累计快照事实表**：覆盖事务从开始到结束的所有关键事件，通常有多个日期字段，允许后续更新，常用于追踪业务全生命周期及状态转换。

## 事实表设计步骤

1. **确定业务过程**：每个业务过程对应一张事实表，实际开发中业务过程和事实表可能多对多。
2. **定义粒度**：每个事实表有唯一粒度，粒度与主键等价，粒度更偏向业务，主键偏向技术。
3. **确定维度**：业务人员会站在哪些角度描述事实度量，常见维度有时间、区域、客户、产品、员工等。
4. **确定事实**：事实表度量的内容，如注册量、登录次数、交易金额等，所有事实必须满足粒度要求。
5. **冗余维度属性**：为满足业务需求和性能要求，建议适当冗余维度属性到事实表，减少大表关联，提升效率。

> 注意：维度属性冗余与模型稳定性有矛盾，属性冗余带来便利但也可能导致数据不一致，需综合考虑。

