几个贴近业务的查询指标，涵盖电影、演员、评分和评论等核心业务场景：

![dashboard](images/dashboard.png)

![datasets](images/datasets.png)

![datasets-builder](images/datasets-builder.png)

![charts](images/charts.png)

![charts-builder](images/charts-builder.png)

![sqllab](images/sqllab.png)


### 1. **电影评分分析**
```sql
-- 豆瓣评分最高的10部电影（需至少10个评分）
SELECT 
    m.movie_id,
    m.name AS movie_title,
    CAST(m.douban_score AS DECIMAL(3,1)) AS douban_score,
    COUNT(r.rating_id) AS rating_count,
    AVG(r.rating) AS avg_rating
FROM movies m
JOIN ratings r ON m.movie_id = r.movie_id
GROUP BY m.movie_id, m.name, m.douban_score
HAVING COUNT(r.rating_id) >= 10
ORDER BY AVG(r.rating) DESC
LIMIT 10;
```

### 2. **演员活跃度分析**
```sql
-- 参演电影最多的前10位演员
SELECT 
    a.actor_id,
    a.name AS actor_name,
    COUNT(ma.ma_id) AS movie_count,
    GROUP_CONCAT(DISTINCT m.name ORDER BY m.name SEPARATOR ', ') AS recent_movies
FROM actors a
JOIN movie_actors ma ON a.actor_id = ma.actor_id
JOIN movies m ON ma.movie_id = m.movie_id
GROUP BY a.actor_id, a.name
ORDER BY movie_count DESC
LIMIT 10;
```

### 3. **导演作品分析**
```sql
-- 执导电影数量最多的前10位导演
SELECT 
    d.actor_id,
    d.name AS director_name,
    COUNT(md.md_id) AS directed_movies,
    AVG(CAST(m.douban_score AS DECIMAL(3,1))) AS avg_douban_score
FROM actors d
JOIN movie_directors md ON d.actor_id = md.director_id
JOIN movies m ON md.movie_id = m.movie_id
GROUP BY d.actor_id, d.name
ORDER BY directed_movies DESC
LIMIT 10;
```

### 4. **电影评论热度分析**
```sql
-- 评论数量最多的前10部电影（含最新评论日期）
SELECT 
    m.movie_id,
    m.name AS movie_title,
    COUNT(c.comment_id) AS comment_count,
    MAX(c.comment_date) AS last_comment_date
FROM movies m
JOIN comments c ON m.movie_id = c.movie_id
GROUP BY m.movie_id, m.name
ORDER BY comment_count DESC
LIMIT 10;
```

### 5. **演员-导演合作分析**
```sql
-- 最常合作的演员-导演组合
SELECT 
    a.actor_id,
    a.name AS actor_name,
    d.actor_id AS director_id,
    d.name AS director_name,
    COUNT(*) AS collaboration_count,
    GROUP_CONCAT(DISTINCT m.name ORDER BY m.year DESC SEPARATOR ', ') AS collaboration_movies
FROM movie_actors ma
JOIN movie_directors md ON ma.movie_id = md.movie_id
JOIN actors a ON ma.actor_id = a.actor_id
JOIN actors d ON md.director_id = d.actor_id
JOIN movies m ON ma.movie_id = m.movie_id
WHERE a.actor_id != d.actor_id
GROUP BY a.actor_id, a.name, d.actor_id, d.name
ORDER BY collaboration_count DESC
LIMIT 10;
```

### 6. **电影类型分析**
```sql
-- 各类型电影的平均评分（按豆瓣评分）
SELECT 
    SUBSTRING_INDEX(SUBSTRING_INDEX(m.genres, ',', n.n), ',', -1) AS genre,
    COUNT(*) AS movie_count,
    AVG(CAST(m.douban_score AS DECIMAL(3,1))) AS avg_douban_score
FROM movies m
JOIN (SELECT 1 AS n UNION SELECT 2 UNION SELECT 3 UNION SELECT 4) n
    ON CHAR_LENGTH(m.genres) - CHAR_LENGTH(REPLACE(m.genres, ',', '')) >= n.n - 1
WHERE m.genres IS NOT NULL AND m.genres != ''
GROUP BY genre
ORDER BY avg_douban_score DESC;
```

### 7. **用户评分行为分析**
```sql
-- 最活跃的评分用户（评分数量最多的前10位用户）
SELECT 
    u.user_id,
    COUNT(r.rating_id) AS rating_count,
    MIN(r.created_at) AS first_rating_date,
    MAX(r.created_at) AS last_rating_date,
    AVG(r.rating) AS avg_rating_given
FROM ratings r
JOIN users u ON r.user_id = u.user_id
GROUP BY u.user_id
ORDER BY rating_count DESC
LIMIT 10;
```

### 指标设计说明：
1. **数据完整性保障**：所有查询都包含数据校验（评分数量阈值、非空检查）
2. **业务相关性**：聚焦核心业务实体（电影、演员、导演、用户）
3. **多维度分析**：结合评分、评论、合作等多维数据
4. **性能优化**：
   - 合理使用索引（movie_id, actor_id等）
   - 限制结果集大小（LIMIT 10）
   - 避免N+1查询（使用JOIN替代子查询）
5. **可读性增强**：
   - 清晰的列别名（AS语法）
   - 结果聚合（GROUP_CONCAT）
   - 数据格式化（CAST处理评分）

这些指标可用于构建电影推荐系统、演员影响力分析、导演风格分析等实际业务场景，直接基于您提供的数据库结构设计，确保可执行性。