# 数据聚合与分组运算
对数据集进行分组并对各组应用一个函数（无论是聚合还是转换），通常是数据分析工作中的重要环节。在将数据集加载、融合、准备好之后，通常就是计算分组统计或生成透视表。pandas提供了一个灵活高效的gruopby功能，它使你能以一种自然的方式对数据集进行切片、切块、摘要等操作。<br>
由于Python和pandas强大的表达能力，我们可以执行复杂得多的分组运算（利用任何可以接受pandas对象或NumPy数组的函数）
* 使用一个或多个键（形式可以是函数、数组或DataFrame列名）分割pandas对象。
* 计算分组的概述统计，比如数量、平均值或标准差，或是用户定义的函数。
* 应用组内转换或其他运算，如规格化、线性回归、排名或选取子集等。
* 计算透视表或交叉表。
* 执行分位数分析以及其它统计分组分析。

# GroupBy机制
第一个阶段，pandas对象（无论是Series、DataFrame还是其他的）中的数据会根据你所提供的一个或多个键被拆分（split）为多组。拆分操作是在对象的特定轴上执行的。例如，DataFrame可以在其行（axis=0）或列（axis=1）上进行分组。然后，将一个函数应用（apply）到各个分组并产生一个新值。最后，所有这些函数的执行结果会被合并（combine）到最终的结果对象中。结果对象的形式一般取决于数据上所执行的操作。
![image.png](29._pandas分组运算和数据聚合_files/image.png)

分组键可以有多种形式，且类型不必相同：
* 列表或数组，其长度与待分组的轴一样。
* 表示DataFrame某个列名的值。
* 字典或Series，给出待分组轴上的值与分组名之间的对应关系。
* 函数，用于处理轴索引或索引中的各个标签。<br>

**注意**，后三种都只是快捷方式而已，其最终目的仍然是产生一组用于拆分对象的值。

# A股整体概况数据分析


```python
import tushare as ts
import pandas as  pd
import pyecharts as pe
```


```python
stocks=ts.get_stock_basics()
stocks.iloc[:5,:10]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
      <th>totals</th>
      <th>totalAssets</th>
      <th>liquidAssets</th>
      <th>fixedAssets</th>
      <th>reserved</th>
    </tr>
    <tr>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>601869</th>
      <td>N长飞</td>
      <td>元器件</td>
      <td>湖北</td>
      <td>19.59</td>
      <td>0.76</td>
      <td>7.58</td>
      <td>965787.69</td>
      <td>561101.50</td>
      <td>189854.81</td>
      <td>155202.56</td>
    </tr>
    <tr>
      <th>000955</th>
      <td>欣龙控股</td>
      <td>纺织</td>
      <td>海南</td>
      <td>0.00</td>
      <td>5.38</td>
      <td>5.38</td>
      <td>130058.56</td>
      <td>66284.50</td>
      <td>44417.80</td>
      <td>49573.46</td>
    </tr>
    <tr>
      <th>002195</th>
      <td>二三四五</td>
      <td>软件服务</td>
      <td>上海</td>
      <td>22.88</td>
      <td>42.30</td>
      <td>44.36</td>
      <td>957737.19</td>
      <td>540403.31</td>
      <td>7009.65</td>
      <td>272988.91</td>
    </tr>
    <tr>
      <th>002580</th>
      <td>圣阳股份</td>
      <td>电气设备</td>
      <td>山东</td>
      <td>140.59</td>
      <td>2.98</td>
      <td>3.54</td>
      <td>199927.50</td>
      <td>139065.56</td>
      <td>42368.53</td>
      <td>53754.13</td>
    </tr>
    <tr>
      <th>002608</th>
      <td>江苏国信</td>
      <td>火力发电</td>
      <td>江苏</td>
      <td>16.70</td>
      <td>5.39</td>
      <td>37.78</td>
      <td>4652351.50</td>
      <td>864956.13</td>
      <td>2432949.75</td>
      <td>1310714.00</td>
    </tr>
  </tbody>
</table>
</div>



* code,代码
* name,名称
* industry,所属行业
* area,地区
* pe,市盈率
* outstanding,流通股本(亿)
* totals,总股本(亿)
* totalAssets,总资产(万)
* liquidAssets,流动资产
* fixedAssets,固定资产
* reserved,公积金
* reservedPerShare,每股公积金
* esp,每股收益
* bvps,每股净资
* pb,市净率
* timeToMarket,上市日期
* undp,未分利润
* perundp, 每股未分配
* rev,收入同比(%)
* profit,利润同比(%)
* gpr,毛利率(%)
* npr,净利润率(%)
* holders,股东人数
# A股行业、地域、市盈率、流通股本


```python
df=stocks.iloc[:,1:5]
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>601869</th>
      <td>元器件</td>
      <td>湖北</td>
      <td>19.59</td>
      <td>0.76</td>
    </tr>
    <tr>
      <th>000955</th>
      <td>纺织</td>
      <td>海南</td>
      <td>0.00</td>
      <td>5.38</td>
    </tr>
    <tr>
      <th>002195</th>
      <td>软件服务</td>
      <td>上海</td>
      <td>22.88</td>
      <td>42.30</td>
    </tr>
    <tr>
      <th>002580</th>
      <td>电气设备</td>
      <td>山东</td>
      <td>140.59</td>
      <td>2.98</td>
    </tr>
    <tr>
      <th>002608</th>
      <td>火力发电</td>
      <td>江苏</td>
      <td>16.70</td>
      <td>5.39</td>
    </tr>
  </tbody>
</table>
</div>



eg.按照行业对A股所有股票的市盈率分组


```python
grouped=df.pe.groupby(df.industry)
grouped
```




    <pandas.core.groupby.groupby.SeriesGroupBy object at 0x00000178A9913EF0>



变量grouped是一个GroupBy对象。它实际上还没有进行任何计算，只是含有一些有关分组键《行业》的中间数据而已。换句话说，该对象已经有了接下来对各分组执行运算所需的一切信息。例如，我们可以调用GroupBy的mean方法来计算分组平均值：


```python
grouped.mean().head()
```




    industry
    专用机械    121.122109
    中成药      46.751733
    乳制品      59.161818
    互联网      60.499808
    仓储物流     65.546571
    Name: pe, dtype: float64



上面，数据（Series）根据分组键进行了聚合，产生了一个新的Series。<br>
如果我们一次传入多个数组的列表，就会得到不同的结果：


```python
grouped=df.pe.groupby([df.industry,df.area])
grouped
```




    <pandas.core.groupby.groupby.SeriesGroupBy object at 0x00000178A9823748>




```python
grouped.mean().head()
```




    industry  area
    专用机械      上海      182.131000
              北京       67.731250
              四川       55.238571
              天津        0.000000
              安徽       37.238000
    Name: pe, dtype: float64



这里，我通过两个键对数据进行了分组，得到的Series具有一个层次化索引（由唯一的键对组成）：


```python
grouped.mean().unstack().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>area</th>
      <th>上海</th>
      <th>云南</th>
      <th>内蒙</th>
      <th>北京</th>
      <th>吉林</th>
      <th>四川</th>
      <th>天津</th>
      <th>宁夏</th>
      <th>安徽</th>
      <th>山东</th>
      <th>...</th>
      <th>湖南</th>
      <th>甘肃</th>
      <th>福建</th>
      <th>西藏</th>
      <th>贵州</th>
      <th>辽宁</th>
      <th>重庆</th>
      <th>陕西</th>
      <th>青海</th>
      <th>黑龙江</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>专用机械</th>
      <td>182.131</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>67.731250</td>
      <td>NaN</td>
      <td>55.238571</td>
      <td>0.00</td>
      <td>NaN</td>
      <td>37.238</td>
      <td>34.862500</td>
      <td>...</td>
      <td>NaN</td>
      <td>0.00</td>
      <td>143.6725</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>191.73125</td>
      <td>NaN</td>
      <td>0.00</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>51.14</td>
      <td>76.06</td>
      <td>36.520000</td>
      <td>28.508</td>
      <td>112.100000</td>
      <td>22.34</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>32.806667</td>
      <td>...</td>
      <td>47.372</td>
      <td>69.77</td>
      <td>56.4100</td>
      <td>62.743333</td>
      <td>32.2725</td>
      <td>NaN</td>
      <td>161.19</td>
      <td>104.65</td>
      <td>85.54</td>
      <td>20.96</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>NaN</td>
      <td>19.93</td>
      <td>58.180000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>60.17</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>89.756364</td>
      <td>NaN</td>
      <td>35.840000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.870</td>
      <td>24.626667</td>
      <td>...</td>
      <td>274.885</td>
      <td>NaN</td>
      <td>27.5625</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>13.01000</td>
      <td>32.00</td>
      <td>NaN</td>
      <td>29.29</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>25.703333</td>
      <td>NaN</td>
      <td>13.085000</td>
      <td>208.96</td>
      <td>NaN</td>
      <td>49.790</td>
      <td>8.940000</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.7200</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>29.85000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.09</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div>



通常，分组信息就位于相同的要处理DataFrame中。这里，你还可以将列名（可以是字符串、数字或其他Python对象）用作分组键：


```python
df.groupby(['industry']).mean().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>industry</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>专用机械</th>
      <td>121.122109</td>
      <td>3.317656</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>46.751733</td>
      <td>6.880533</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>59.161818</td>
      <td>10.132727</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>60.499808</td>
      <td>6.817692</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>65.546571</td>
      <td>5.957143</td>
    </tr>
  </tbody>
</table>
</div>



结果中没有"area"列，是因为该列不是数值数据，所以从结果中排除了。


```python
df.groupby(['industry','area']).mean().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>industry</th>
      <th>area</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">专用机械</th>
      <th>上海</th>
      <td>182.131000</td>
      <td>1.278000</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>67.731250</td>
      <td>5.713750</td>
    </tr>
    <tr>
      <th>四川</th>
      <td>55.238571</td>
      <td>3.778571</td>
    </tr>
    <tr>
      <th>天津</th>
      <td>0.000000</td>
      <td>2.750000</td>
    </tr>
    <tr>
      <th>安徽</th>
      <td>37.238000</td>
      <td>1.980000</td>
    </tr>
  </tbody>
</table>
</div>



GroupBy的size方法，它可以返回一个含有分组大小的Series：


```python
df.groupby(['industry','area']).size().head()
```




    industry  area
    专用机械      上海      10
              北京       8
              四川       7
              天津       1
              安徽       5
    dtype: int64



# 对分组进行迭代
GroupBy对象支持迭代，可以产生一组二元元组（由分组名和数据块组成）。


```python
grouped=df.groupby(['area'])
xa=iter(grouped)
xb=next(xa)
```


```python
xb[1].head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>002195</th>
      <td>软件服务</td>
      <td>上海</td>
      <td>22.88</td>
      <td>42.30</td>
    </tr>
    <tr>
      <th>002184</th>
      <td>软件服务</td>
      <td>上海</td>
      <td>0.00</td>
      <td>1.36</td>
    </tr>
    <tr>
      <th>603713</th>
      <td>仓储物流</td>
      <td>上海</td>
      <td>29.76</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>603009</th>
      <td>汽车配件</td>
      <td>上海</td>
      <td>31.44</td>
      <td>3.21</td>
    </tr>
    <tr>
      <th>300551</th>
      <td>专用机械</td>
      <td>上海</td>
      <td>0.00</td>
      <td>0.65</td>
    </tr>
  </tbody>
</table>
</div>



对于多重键的情况，元组的第一个元素将会是由键值组成的元组：


```python
grouped=df.groupby(['area','industry'])
xa=iter(grouped)
xb=next(xa)
```


```python
xb[0]
```




    ('上海', '专用机械')




```python
ls=list(grouped)
ls[:2]
```




    [(('上海', '专用机械'),        industry area      pe  outstanding
      code                                     
      300551     专用机械   上海    0.00         0.65
      603690     专用机械   上海  661.67         0.91
      300483     专用机械   上海   69.72         0.61
      603131     专用机械   上海  777.98         0.50
      603855     专用机械   上海   36.31         2.02
      603960     专用机械   上海   83.16         0.52
      603159     专用机械   上海   51.36         0.25
      300462     专用机械   上海   29.17         0.68
      603012     专用机械   上海   29.99         6.37
      603895     专用机械   上海   81.95         0.27),
     (('上海', '中成药'),        industry area     pe  outstanding
      code                                    
      600272      中成药   上海  58.76         1.60
      300039      中成药   上海  15.55         7.19
      600613      中成药   上海  27.21         4.79)]




```python
dc=dict(ls)
```

# 选取一列或列的子集
对于由DataFrame产生的GroupBy对象，如果用一个（单个字符串）或一组（字符串数组）列名对其进行索引，就能实现选取部分列进行聚合的目的。


```python
df.groupby('area')[['pe']]
```




    <pandas.core.groupby.groupby.DataFrameGroupBy object at 0x00000178A9BCC978>




```python
df[['pe']].groupby(df.area)
```




    <pandas.core.groupby.groupby.DataFrameGroupBy object at 0x00000178A9BCCB38>




```python
df.groupby('area')['pe']
```




    <pandas.core.groupby.groupby.SeriesGroupBy object at 0x00000178A9BCCDD8>




```python
df['pe'].groupby(df.area)
```




    <pandas.core.groupby.groupby.SeriesGroupBy object at 0x00000178A9BCC240>



计算行业、地域对应市盈率的平均值


```python
df.groupby(['industry','area'])[['pe']].mean().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>pe</th>
    </tr>
    <tr>
      <th>industry</th>
      <th>area</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">专用机械</th>
      <th>上海</th>
      <td>182.131000</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>67.731250</td>
    </tr>
    <tr>
      <th>四川</th>
      <td>55.238571</td>
    </tr>
    <tr>
      <th>天津</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>安徽</th>
      <td>37.238000</td>
    </tr>
  </tbody>
</table>
</div>



上面，这种索引操作所返回的对象是一个已分组的DataFrame（如果传入的是列表或数组）或已分组的Series（如果传入的是标量形式的单个列名）。<br>
# 通过函数进行分组
任何被当做分组键的函数都会在各个索引值上被调用一次，其返回值就会被用作分组名称。


```python
df.groupby(lambda x:int(x)%10).count()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>362</td>
      <td>362</td>
      <td>362</td>
      <td>362</td>
    </tr>
    <tr>
      <th>1</th>
      <td>344</td>
      <td>344</td>
      <td>344</td>
      <td>344</td>
    </tr>
    <tr>
      <th>2</th>
      <td>309</td>
      <td>309</td>
      <td>309</td>
      <td>309</td>
    </tr>
    <tr>
      <th>3</th>
      <td>351</td>
      <td>351</td>
      <td>351</td>
      <td>351</td>
    </tr>
    <tr>
      <th>4</th>
      <td>199</td>
      <td>199</td>
      <td>199</td>
      <td>199</td>
    </tr>
    <tr>
      <th>5</th>
      <td>345</td>
      <td>345</td>
      <td>345</td>
      <td>345</td>
    </tr>
    <tr>
      <th>6</th>
      <td>401</td>
      <td>401</td>
      <td>401</td>
      <td>401</td>
    </tr>
    <tr>
      <th>7</th>
      <td>361</td>
      <td>361</td>
      <td>361</td>
      <td>361</td>
    </tr>
    <tr>
      <th>8</th>
      <td>455</td>
      <td>455</td>
      <td>455</td>
      <td>455</td>
    </tr>
    <tr>
      <th>9</th>
      <td>409</td>
      <td>409</td>
      <td>409</td>
      <td>409</td>
    </tr>
  </tbody>
</table>
</div>




```python
"hello".startswith('h')
```




    True




```python
def f(x):
    return '上海' if x.startswith('6') else '深圳'
f('600000')
```




    '上海'




```python
df.groupby([f,'industry']).count().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>47</td>
      <td>47</td>
      <td>47</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>32</td>
      <td>32</td>
      <td>32</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>5</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>10</td>
      <td>10</td>
      <td>10</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>21</td>
      <td>21</td>
      <td>21</td>
    </tr>
  </tbody>
</table>
</div>



# 数据聚合
聚合指的是任何能够从数组产生标量值的数据转换过程。之前的例子已经用过一些，比如mean、count、min以及sum等。
![image.png](29._pandas分组运算和数据聚合_files/image.png)
你可以使用自己发明的聚合运算，还可以调用分组对象上已经定义好的任何方法。例如，quantile可以计算Series或DataFrame列的样本分位数。<br>
虽然quantile并没有明确地实现于GroupBy，但它是一个Series方法，所以这里是能用的。


```python
df.groupby('area')[['pe']].quantile(0.5).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>0.5</th>
      <th>pe</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>31.52</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>33.54</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>26.33</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>33.03</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>28.52</td>
    </tr>
  </tbody>
</table>
</div>



如果要使用你自己的聚合函数，只需将其传入aggregate或agg方法即可：


```python
df.groupby('area')[['outstanding']].agg(lambda x:x.max()-x.min()).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>392.51</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>64.46</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>315.07</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>2940.38</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>31.50</td>
    </tr>
  </tbody>
</table>
</div>



# 面向列的多函数应用
对不同的列使用不同的聚合函数，或一次应用多个函数。<br>
通过自定义函数调用聚合函数的名字，运行聚合运算。


```python
df.groupby(['area','industry'])[['pe','outstanding']].agg("mean").head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>area</th>
      <th>industry</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>182.131</td>
      <td>1.278000</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>4.526667</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>8.135000</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>11.534000</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>2.541667</td>
    </tr>
  </tbody>
</table>
</div>



如果传入一组函数或函数名，得到的DataFrame的列就会以相应的函数命名：


```python
df.groupby(['area','industry'])[['pe','outstanding']].agg(["mean",'std']).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">pe</th>
      <th colspan="2" halign="left">outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
    </tr>
    <tr>
      <th>area</th>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>182.131</td>
      <td>285.879127</td>
      <td>1.278000</td>
      <td>1.857877</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>22.354948</td>
      <td>4.526667</td>
      <td>2.804288</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>16.072537</td>
      <td>8.135000</td>
      <td>5.805347</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>48.200422</td>
      <td>11.534000</td>
      <td>17.064092</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>371.388803</td>
      <td>2.541667</td>
      <td>3.576777</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby(['area','industry'])[['pe','outstanding']].agg(["mean",lambda x:x.max()-x.min()]).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">pe</th>
      <th colspan="2" halign="left">outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>&lt;lambda&gt;</th>
      <th>mean</th>
      <th>&lt;lambda&gt;</th>
    </tr>
    <tr>
      <th>area</th>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>182.131</td>
      <td>777.98</td>
      <td>1.278000</td>
      <td>6.12</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>43.21</td>
      <td>4.526667</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>22.73</td>
      <td>8.135000</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>122.22</td>
      <td>11.534000</td>
      <td>41.00</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>930.73</td>
      <td>2.541667</td>
      <td>9.22</td>
    </tr>
  </tbody>
</table>
</div>



你并非一定要接受GroupBy自动给出的那些列名，特别是lambda函数，它们的名称是'<lambda>'，这样的辨识度就很低了。<br>
因此，如果传入的是一个由(name,function)元组组成的列表，则各元组的第一个元素就会被用作DataFrame的列名（可以将这种二元元组列表看做一个有序映射）：


```python
df.groupby(['area','industry'])[['pe','outstanding']].agg([('平均值',"mean"),('离散度',lambda x:x.max()-x.min())]).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">pe</th>
      <th colspan="2" halign="left">outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>平均值</th>
      <th>离散度</th>
      <th>平均值</th>
      <th>离散度</th>
    </tr>
    <tr>
      <th>area</th>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>182.131</td>
      <td>777.98</td>
      <td>1.278000</td>
      <td>6.12</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>43.21</td>
      <td>4.526667</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>22.73</td>
      <td>8.135000</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>122.22</td>
      <td>11.534000</td>
      <td>41.00</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>930.73</td>
      <td>2.541667</td>
      <td>9.22</td>
    </tr>
  </tbody>
</table>
</div>



如你所见，结果DataFrame拥有层次化的列，这相当于分别对各列进行聚合，然后用concat将结果组装到一起。<br>
现在，假设你想要对一个列或不同的列应用不同的函数。具体的办法是向agg传入一个从列名映射到函数的字典：


```python
df.groupby(['area','industry'])[['pe','outstanding']]. \
agg({'pe':[('平均值','mean'),('最大值',max)],'outstanding':[('离散度',lambda x:x.max()-x.min())]}).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>平均值</th>
      <th>最大值</th>
      <th>离散度</th>
    </tr>
    <tr>
      <th>area</th>
      <th>industry</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">上海</th>
      <th>专用机械</th>
      <td>182.131</td>
      <td>777.98</td>
      <td>6.12</td>
    </tr>
    <tr>
      <th>中成药</th>
      <td>33.840</td>
      <td>58.76</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>乳制品</th>
      <td>11.365</td>
      <td>22.73</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>互联网</th>
      <td>46.272</td>
      <td>122.22</td>
      <td>41.00</td>
    </tr>
    <tr>
      <th>仓储物流</th>
      <td>191.845</td>
      <td>949.04</td>
      <td>9.22</td>
    </tr>
  </tbody>
</table>
</div>



# 以“没有行索引”的形式返回聚合数据
到目前为止，所有示例中的聚合数据都有由唯一的分组键组成的索引（可能还是层次化的）。由于并不总是需要如此，所以你可以向groupby传入as_index=False以禁用该功能：


```python
df.groupby(['area','industry'],as_index=False)[['pe','outstanding']]. \
agg({'pe':[('平均值','mean'),('最大值',max)],'outstanding':[('离散度',lambda x:x.max()-x.min())]}).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>area</th>
      <th>industry</th>
      <th colspan="2" halign="left">pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>平均值</th>
      <th>最大值</th>
      <th>离散度</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>上海</td>
      <td>专用机械</td>
      <td>182.131</td>
      <td>777.98</td>
      <td>6.12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>上海</td>
      <td>中成药</td>
      <td>33.840</td>
      <td>58.76</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>2</th>
      <td>上海</td>
      <td>乳制品</td>
      <td>11.365</td>
      <td>22.73</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>3</th>
      <td>上海</td>
      <td>互联网</td>
      <td>46.272</td>
      <td>122.22</td>
      <td>41.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>上海</td>
      <td>仓储物流</td>
      <td>191.845</td>
      <td>949.04</td>
      <td>9.22</td>
    </tr>
  </tbody>
</table>
</div>



当然，对结果调用reset_index也能得到这种形式的结果。使用as_index=False方法可以避免一些不必要的计算。


```python
df.groupby(['area','industry'])[['pe','outstanding']]. \
agg({'pe':[('平均值','mean'),('最大值',max)],'outstanding':[('离散度',lambda x:x.max()-x.min())]}).reset_index().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>area</th>
      <th>industry</th>
      <th colspan="2" halign="left">pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>平均值</th>
      <th>最大值</th>
      <th>离散度</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>上海</td>
      <td>专用机械</td>
      <td>182.131</td>
      <td>777.98</td>
      <td>6.12</td>
    </tr>
    <tr>
      <th>1</th>
      <td>上海</td>
      <td>中成药</td>
      <td>33.840</td>
      <td>58.76</td>
      <td>5.59</td>
    </tr>
    <tr>
      <th>2</th>
      <td>上海</td>
      <td>乳制品</td>
      <td>11.365</td>
      <td>22.73</td>
      <td>8.21</td>
    </tr>
    <tr>
      <th>3</th>
      <td>上海</td>
      <td>互联网</td>
      <td>46.272</td>
      <td>122.22</td>
      <td>41.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>上海</td>
      <td>仓储物流</td>
      <td>191.845</td>
      <td>949.04</td>
      <td>9.22</td>
    </tr>
  </tbody>
</table>
</div>



# apply：一般性的“拆分－应用－合并”
最通用的GroupBy方法是apply,apply会将待处理的对象拆分成多个片段，然后对各片段调用传入的函数，最后尝试将各片段组合到一起。


```python
df.groupby('area').apply(lambda x:x.sort_values(by='pe')[-3:]).head(11)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>area</th>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">上海</th>
      <th>600732</th>
      <td>区域地产</td>
      <td>上海</td>
      <td>1454.96</td>
      <td>4.46</td>
    </tr>
    <tr>
      <th>603918</th>
      <td>软件服务</td>
      <td>上海</td>
      <td>2235.35</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>600610</th>
      <td>建筑施工</td>
      <td>上海</td>
      <td>3016.25</td>
      <td>3.76</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">云南</th>
      <th>300142</th>
      <td>生物制药</td>
      <td>云南</td>
      <td>340.06</td>
      <td>13.50</td>
    </tr>
    <tr>
      <th>002428</th>
      <td>小金属</td>
      <td>云南</td>
      <td>716.34</td>
      <td>6.44</td>
    </tr>
    <tr>
      <th>601099</th>
      <td>证券</td>
      <td>云南</td>
      <td>759.17</td>
      <td>64.79</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">内蒙</th>
      <th>300355</th>
      <td>环境保护</td>
      <td>内蒙</td>
      <td>122.18</td>
      <td>11.58</td>
    </tr>
    <tr>
      <th>600262</th>
      <td>汽车整车</td>
      <td>内蒙</td>
      <td>138.95</td>
      <td>1.70</td>
    </tr>
    <tr>
      <th>600863</th>
      <td>火力发电</td>
      <td>内蒙</td>
      <td>694.07</td>
      <td>58.08</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">北京</th>
      <th>600764</th>
      <td>通信设备</td>
      <td>北京</td>
      <td>1069.30</td>
      <td>3.30</td>
    </tr>
    <tr>
      <th>300352</th>
      <td>软件服务</td>
      <td>北京</td>
      <td>1209.67</td>
      <td>10.44</td>
    </tr>
  </tbody>
</table>
</div>



函数在DataFrame的各个片段上调用，然后结果由pandas.concat组装到一起，并以分组名称进行了标记。于是，最终结果就有了一个层次化索引，其内层索引值来自原DataFrame。<br>
如果传给apply的函数能够接受其他参数或关键字，则可以将这些内容放在函数名后面一并传入：


```python
def f(x,field='pe',n=3):
    return x.sort_values(by=field)[-n:]
```


```python
df.groupby('area').apply(f,field='outstanding',n=2).head(11)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>industry</th>
      <th>area</th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>area</th>
      <th>code</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">上海</th>
      <th>600000</th>
      <td>银行</td>
      <td>上海</td>
      <td>5.06</td>
      <td>281.04</td>
    </tr>
    <tr>
      <th>601328</th>
      <td>银行</td>
      <td>上海</td>
      <td>5.21</td>
      <td>392.51</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">云南</th>
      <th>600497</th>
      <td>铅锌</td>
      <td>云南</td>
      <td>15.71</td>
      <td>43.10</td>
    </tr>
    <tr>
      <th>601099</th>
      <td>证券</td>
      <td>云南</td>
      <td>759.17</td>
      <td>64.79</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">内蒙</th>
      <th>601216</th>
      <td>化工原料</td>
      <td>内蒙</td>
      <td>8.81</td>
      <td>84.38</td>
    </tr>
    <tr>
      <th>600010</th>
      <td>普钢</td>
      <td>内蒙</td>
      <td>27.73</td>
      <td>316.77</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">北京</th>
      <th>601398</th>
      <td>银行</td>
      <td>北京</td>
      <td>6.18</td>
      <td>2696.12</td>
    </tr>
    <tr>
      <th>601288</th>
      <td>银行</td>
      <td>北京</td>
      <td>5.27</td>
      <td>2940.55</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">吉林</th>
      <th>601929</th>
      <td>影视音像</td>
      <td>吉林</td>
      <td>46.14</td>
      <td>31.11</td>
    </tr>
    <tr>
      <th>600881</th>
      <td>水泥</td>
      <td>吉林</td>
      <td>0.00</td>
      <td>32.23</td>
    </tr>
    <tr>
      <th>四川</th>
      <th>000629</th>
      <td>小金属</td>
      <td>四川</td>
      <td>0.00</td>
      <td>47.67</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3536.000000</td>
      <td>3536.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>85.620803</td>
      <td>13.470546</td>
    </tr>
    <tr>
      <th>std</th>
      <td>297.688646</td>
      <td>85.736708</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>14.685000</td>
      <td>1.790000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>31.820000</td>
      <td>4.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>67.190000</td>
      <td>9.565000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>10609.500000</td>
      <td>2940.550000</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby('area').describe().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="8" halign="left">outstanding</th>
      <th colspan="8" halign="left">pe</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>283.0</td>
      <td>14.369293</td>
      <td>37.735218</td>
      <td>0.00</td>
      <td>1.575</td>
      <td>4.61</td>
      <td>9.62</td>
      <td>392.51</td>
      <td>283.0</td>
      <td>91.653746</td>
      <td>276.708323</td>
      <td>0.0</td>
      <td>14.4600</td>
      <td>31.52</td>
      <td>64.160</td>
      <td>3016.25</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>33.0</td>
      <td>11.038182</td>
      <td>13.198717</td>
      <td>0.33</td>
      <td>3.030</td>
      <td>6.76</td>
      <td>13.50</td>
      <td>64.79</td>
      <td>33.0</td>
      <td>103.613030</td>
      <td>181.767848</td>
      <td>0.0</td>
      <td>9.9200</td>
      <td>33.54</td>
      <td>100.510</td>
      <td>759.17</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>25.0</td>
      <td>30.212000</td>
      <td>63.247214</td>
      <td>1.70</td>
      <td>4.850</td>
      <td>11.37</td>
      <td>26.74</td>
      <td>316.77</td>
      <td>25.0</td>
      <td>63.537600</td>
      <td>137.184649</td>
      <td>0.0</td>
      <td>9.2300</td>
      <td>26.33</td>
      <td>73.420</td>
      <td>694.07</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>310.0</td>
      <td>57.010032</td>
      <td>279.222247</td>
      <td>0.17</td>
      <td>2.540</td>
      <td>5.77</td>
      <td>14.81</td>
      <td>2940.55</td>
      <td>310.0</td>
      <td>95.557581</td>
      <td>181.475243</td>
      <td>0.0</td>
      <td>12.5225</td>
      <td>33.03</td>
      <td>93.005</td>
      <td>1318.61</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>41.0</td>
      <td>9.376829</td>
      <td>8.305006</td>
      <td>0.73</td>
      <td>3.360</td>
      <td>6.70</td>
      <td>12.13</td>
      <td>32.23</td>
      <td>41.0</td>
      <td>100.873415</td>
      <td>245.862436</td>
      <td>0.0</td>
      <td>14.2600</td>
      <td>28.52</td>
      <td>57.890</td>
      <td>1383.56</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby('area').apply(lambda x:x.describe()).head(11)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">上海</th>
      <th>count</th>
      <td>283.000000</td>
      <td>283.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>91.653746</td>
      <td>14.369293</td>
    </tr>
    <tr>
      <th>std</th>
      <td>276.708323</td>
      <td>37.735218</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>14.460000</td>
      <td>1.575000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>31.520000</td>
      <td>4.610000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>64.160000</td>
      <td>9.620000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3016.250000</td>
      <td>392.510000</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">云南</th>
      <th>count</th>
      <td>33.000000</td>
      <td>33.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>103.613030</td>
      <td>11.038182</td>
    </tr>
    <tr>
      <th>std</th>
      <td>181.767848</td>
      <td>13.198717</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.groupby('area').apply(lambda x:x.describe()).unstack().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="8" halign="left">pe</th>
      <th colspan="8" halign="left">outstanding</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>283.0</td>
      <td>91.653746</td>
      <td>276.708323</td>
      <td>0.0</td>
      <td>14.4600</td>
      <td>31.52</td>
      <td>64.160</td>
      <td>3016.25</td>
      <td>283.0</td>
      <td>14.369293</td>
      <td>37.735218</td>
      <td>0.00</td>
      <td>1.575</td>
      <td>4.61</td>
      <td>9.62</td>
      <td>392.51</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>33.0</td>
      <td>103.613030</td>
      <td>181.767848</td>
      <td>0.0</td>
      <td>9.9200</td>
      <td>33.54</td>
      <td>100.510</td>
      <td>759.17</td>
      <td>33.0</td>
      <td>11.038182</td>
      <td>13.198717</td>
      <td>0.33</td>
      <td>3.030</td>
      <td>6.76</td>
      <td>13.50</td>
      <td>64.79</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>25.0</td>
      <td>63.537600</td>
      <td>137.184649</td>
      <td>0.0</td>
      <td>9.2300</td>
      <td>26.33</td>
      <td>73.420</td>
      <td>694.07</td>
      <td>25.0</td>
      <td>30.212000</td>
      <td>63.247214</td>
      <td>1.70</td>
      <td>4.850</td>
      <td>11.37</td>
      <td>26.74</td>
      <td>316.77</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>310.0</td>
      <td>95.557581</td>
      <td>181.475243</td>
      <td>0.0</td>
      <td>12.5225</td>
      <td>33.03</td>
      <td>93.005</td>
      <td>1318.61</td>
      <td>310.0</td>
      <td>57.010032</td>
      <td>279.222247</td>
      <td>0.17</td>
      <td>2.540</td>
      <td>5.77</td>
      <td>14.81</td>
      <td>2940.55</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>41.0</td>
      <td>100.873415</td>
      <td>245.862436</td>
      <td>0.0</td>
      <td>14.2600</td>
      <td>28.52</td>
      <td>57.890</td>
      <td>1383.56</td>
      <td>41.0</td>
      <td>9.376829</td>
      <td>8.305006</td>
      <td>0.73</td>
      <td>3.360</td>
      <td>6.70</td>
      <td>12.13</td>
      <td>32.23</td>
    </tr>
  </tbody>
</table>
</div>



# 禁止分组键
从上面的例子中可以看出，分组键会跟原始对象的索引共同构成结果对象中的层次化索引。将group_keys=False传入groupby即可禁止该效果：


```python
df.groupby(['area'],group_keys=False).apply(lambda x:x.describe()).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pe</th>
      <th>outstanding</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>283.000000</td>
      <td>283.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>91.653746</td>
      <td>14.369293</td>
    </tr>
    <tr>
      <th>std</th>
      <td>276.708323</td>
      <td>37.735218</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>14.460000</td>
      <td>1.575000</td>
    </tr>
  </tbody>
</table>
</div>



# 透视表和交叉表
透视表（pivot table）是各种电子表格程序和其他数据分析软件中一种常见的数据汇总工具。它根据一个或多个键对数据进行聚合，并根据行和列上的分组键将数据分配到各个矩形区域中。<br>
**注意：**计算分组平均数（pivot_table的默认聚合类型）


```python
df.pivot_table(values=['pe'],index=['area'],columns=['industry']).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="21" halign="left">pe</th>
    </tr>
    <tr>
      <th>industry</th>
      <th>专用机械</th>
      <th>中成药</th>
      <th>乳制品</th>
      <th>互联网</th>
      <th>仓储物流</th>
      <th>供气供热</th>
      <th>保险</th>
      <th>元器件</th>
      <th>全国地产</th>
      <th>公共交通</th>
      <th>...</th>
      <th>钢加工</th>
      <th>铁路</th>
      <th>铅锌</th>
      <th>铜</th>
      <th>铝</th>
      <th>银行</th>
      <th>陶瓷</th>
      <th>食品</th>
      <th>饲料</th>
      <th>黄金</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>182.13100</td>
      <td>33.840</td>
      <td>11.365</td>
      <td>46.272000</td>
      <td>191.845000</td>
      <td>99.760000</td>
      <td>20.630</td>
      <td>32.243333</td>
      <td>10.004000</td>
      <td>37.302</td>
      <td>...</td>
      <td>0.00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>53.09</td>
      <td>NaN</td>
      <td>5.610000</td>
      <td>NaN</td>
      <td>17.305</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>NaN</td>
      <td>51.140</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>51.85</td>
      <td>27.54</td>
      <td>0.00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>31.430</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>NaN</td>
      <td>76.060</td>
      <td>19.930</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>17.380</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>33.87</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000</td>
      <td>NaN</td>
      <td>56.50</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>67.73125</td>
      <td>36.520</td>
      <td>58.180</td>
      <td>89.756364</td>
      <td>25.703333</td>
      <td>8.400000</td>
      <td>13.605</td>
      <td>104.880000</td>
      <td>42.138333</td>
      <td>51.260</td>
      <td>...</td>
      <td>159.08</td>
      <td>NaN</td>
      <td>25.60</td>
      <td>NaN</td>
      <td>42.25</td>
      <td>5.437778</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>20.475</td>
      <td>99.46</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>NaN</td>
      <td>28.508</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.056667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>17.24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 110 columns</p>
</div>




```python
df.pivot_table(values=['pe'],index=['area'],columns=['industry'],aggfunc="mean",margins=True,fill_value=0).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="21" halign="left">pe</th>
    </tr>
    <tr>
      <th>industry</th>
      <th>专用机械</th>
      <th>中成药</th>
      <th>乳制品</th>
      <th>互联网</th>
      <th>仓储物流</th>
      <th>供气供热</th>
      <th>保险</th>
      <th>元器件</th>
      <th>全国地产</th>
      <th>公共交通</th>
      <th>...</th>
      <th>铁路</th>
      <th>铅锌</th>
      <th>铜</th>
      <th>铝</th>
      <th>银行</th>
      <th>陶瓷</th>
      <th>食品</th>
      <th>饲料</th>
      <th>黄金</th>
      <th>All</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>182.13100</td>
      <td>33.840</td>
      <td>11.365</td>
      <td>46.272000</td>
      <td>191.845000</td>
      <td>99.760000</td>
      <td>20.630</td>
      <td>32.243333</td>
      <td>10.004000</td>
      <td>37.302</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>53.09</td>
      <td>0.00</td>
      <td>5.610000</td>
      <td>0.0</td>
      <td>17.305</td>
      <td>0.000</td>
      <td>0.00</td>
      <td>91.653746</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>0.00000</td>
      <td>51.140</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
      <td>...</td>
      <td>0.0</td>
      <td>51.85</td>
      <td>27.54</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>31.430</td>
      <td>0.000</td>
      <td>0.00</td>
      <td>103.613030</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>0.00000</td>
      <td>76.060</td>
      <td>19.930</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>17.380</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
      <td>...</td>
      <td>0.0</td>
      <td>33.87</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>56.50</td>
      <td>63.537600</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>67.73125</td>
      <td>36.520</td>
      <td>58.180</td>
      <td>89.756364</td>
      <td>25.703333</td>
      <td>8.400000</td>
      <td>13.605</td>
      <td>104.880000</td>
      <td>42.138333</td>
      <td>51.260</td>
      <td>...</td>
      <td>0.0</td>
      <td>25.60</td>
      <td>0.00</td>
      <td>42.25</td>
      <td>5.437778</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>20.475</td>
      <td>99.46</td>
      <td>95.557581</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>0.00000</td>
      <td>28.508</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>10.056667</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>17.24</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.00</td>
      <td>100.873415</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 111 columns</p>
</div>



![image.png](29._pandas分组运算和数据聚合_files/image.png)

# 交叉表：crosstab
交叉表（cross-tabulation，简称crosstab）是一种用于计算分组频率的特殊透视表。


```python
pd.crosstab(index=df.area,columns=df.industry,margins=True)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>industry</th>
      <th>专用机械</th>
      <th>中成药</th>
      <th>乳制品</th>
      <th>互联网</th>
      <th>仓储物流</th>
      <th>供气供热</th>
      <th>保险</th>
      <th>元器件</th>
      <th>全国地产</th>
      <th>公共交通</th>
      <th>...</th>
      <th>铁路</th>
      <th>铅锌</th>
      <th>铜</th>
      <th>铝</th>
      <th>银行</th>
      <th>陶瓷</th>
      <th>食品</th>
      <th>饲料</th>
      <th>黄金</th>
      <th>All</th>
    </tr>
    <tr>
      <th>area</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>上海</th>
      <td>10</td>
      <td>3</td>
      <td>2</td>
      <td>5</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
      <td>5</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>283</td>
    </tr>
    <tr>
      <th>云南</th>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>33</td>
    </tr>
    <tr>
      <th>内蒙</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>25</td>
    </tr>
    <tr>
      <th>北京</th>
      <td>8</td>
      <td>2</td>
      <td>1</td>
      <td>11</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>6</td>
      <td>6</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>310</td>
    </tr>
    <tr>
      <th>吉林</th>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>41</td>
    </tr>
    <tr>
      <th>四川</th>
      <td>7</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>119</td>
    </tr>
    <tr>
      <th>天津</th>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
    </tr>
    <tr>
      <th>宁夏</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>13</td>
    </tr>
    <tr>
      <th>安徽</th>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>105</td>
    </tr>
    <tr>
      <th>山东</th>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
      <td>1</td>
      <td>4</td>
      <td>194</td>
    </tr>
    <tr>
      <th>山西</th>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>38</td>
    </tr>
    <tr>
      <th>广东</th>
      <td>11</td>
      <td>8</td>
      <td>1</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>0</td>
      <td>32</td>
      <td>3</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>4</td>
      <td>9</td>
      <td>2</td>
      <td>0</td>
      <td>304</td>
    </tr>
    <tr>
      <th>广西</th>
      <td>0</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>37</td>
    </tr>
    <tr>
      <th>新疆</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>53</td>
    </tr>
    <tr>
      <th>江苏</th>
      <td>25</td>
      <td>2</td>
      <td>0</td>
      <td>7</td>
      <td>6</td>
      <td>1</td>
      <td>0</td>
      <td>15</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>395</td>
    </tr>
    <tr>
      <th>江西</th>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>39</td>
    </tr>
    <tr>
      <th>河北</th>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
    </tr>
    <tr>
      <th>河南</th>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>78</td>
    </tr>
    <tr>
      <th>浙江</th>
      <td>24</td>
      <td>5</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>17</td>
      <td>5</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>426</td>
    </tr>
    <tr>
      <th>海南</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>31</td>
    </tr>
    <tr>
      <th>深圳</th>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>42</td>
      <td>8</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>277</td>
    </tr>
    <tr>
      <th>湖北</th>
      <td>4</td>
      <td>3</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>99</td>
    </tr>
    <tr>
      <th>湖南</th>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>104</td>
    </tr>
    <tr>
      <th>甘肃</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>33</td>
    </tr>
    <tr>
      <th>福建</th>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>2</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>131</td>
    </tr>
    <tr>
      <th>西藏</th>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>17</td>
    </tr>
    <tr>
      <th>贵州</th>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>29</td>
    </tr>
    <tr>
      <th>辽宁</th>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>72</td>
    </tr>
    <tr>
      <th>重庆</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>49</td>
    </tr>
    <tr>
      <th>陕西</th>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>47</td>
    </tr>
    <tr>
      <th>青海</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>黑龙江</th>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>36</td>
    </tr>
    <tr>
      <th>All</th>
      <td>128</td>
      <td>75</td>
      <td>11</td>
      <td>52</td>
      <td>35</td>
      <td>28</td>
      <td>6</td>
      <td>162</td>
      <td>37</td>
      <td>9</td>
      <td>...</td>
      <td>3</td>
      <td>14</td>
      <td>14</td>
      <td>25</td>
      <td>26</td>
      <td>7</td>
      <td>58</td>
      <td>18</td>
      <td>11</td>
      <td>3536</td>
    </tr>
  </tbody>
</table>
<p>33 rows × 111 columns</p>
</div>


