# 时间序列（time series）
时间序列（time series）数据是一种重要的结构化数据形式。时间序列数据的意义取决于具体的应用场景，主要有以下几种：
* 时间戳（timestamp），特定的时刻。
* 固定时期（period），如2007年1月或2010年全年。
* 时间间隔（interval），由起始和结束时间戳表示。时期（period）可以被看做间隔（interval）的特例。
* 实验或过程时间，每个时间点都是相对于特定起始时间的一个度量。例如，从放入烤箱时起，每秒钟饼干的直径。

<br>
pandas提供了许多内置的时间序列处理工具和数据算法。因此，你可以高效处理非常大的时间序列，轻松地进行切片/切块、聚合、对定期/不定期的时间序列进行重采样等。
# 日期和时间数据类型及工具
Python标准库包含用于日期（date）和时间（time）数据的数据类型，而且还有日历方面的功能。我们主要会用到datetime、time以及calendar模块。datetime.datetime（也可以简写为datetime）是用得最多的数据类型：


```python
from datetime import datetime
now=datetime.now()
now
```




    datetime.datetime(2018, 7, 28, 18, 7, 41, 940759)




```python
now.year,now.month,now.day
```




    (2018, 7, 28)



datetime以毫秒形式存储日期和时间。timedelta表示两个datetime对象之间的时间差：


```python
delta=datetime(2018,7,7,1,1,1)-datetime(2018,6,6,2,2,2)
```


```python
delta.days,delta.seconds,delta.microseconds
```




    (30, 82739, 0)



可以给datetime对象加上（或减去）一个或多个timedelta，这样会产生一个新对象：


```python
from datetime import timedelta
start=datetime(2018,8,8)
end=start+timedelta(12)
start,end
```




    (datetime.datetime(2018, 8, 8, 0, 0), datetime.datetime(2018, 8, 20, 0, 0))



datetime模块中的数据类型:
![image.png](30._pandas时间序列_files/image.png)

# 字符串和datetime的相互转换


```python
dt=datetime(2018,8,8)
str(dt)
```




    '2018-08-08 00:00:00'




```python
dt.strftime('%Y/%m/%d')
```




    '2018/08/08'




```python
ls=["%y 两位数的年份表示（00-99）"
,"%Y 四位数的年份表示（000-9999）"
,"%m 月份（01-12）"
,"%d 月内中的一天（0-31）"
,"%H 24小时制小时数（0-23）"
,"%I 12小时制小时数（01-12）"
,"%M 分钟数（00=59）"
,"%S 秒（00-59）"
,"%a 本地简化星期名称"
,"%A 本地完整星期名称"
,"%b 本地简化的月份名称"
,"%B 本地完整的月份名称"
,"%c 本地相应的日期表示和时间表示"
,"%j 年内的一天（001-366）"
,"%p 本地A.M.或P.M.的等价符"
,"%U 一年中的星期数（00-53）星期天为星期的开始"
,"%w 星期（0-6），星期天为星期的开始"
,"%W 一年中的星期数（00-53）星期一为星期的开始"
,"%x 本地相应的日期表示"
,"%X 本地相应的时间表示"
,"%Z 当前时区的名称"
,"%% %号本身"]
for i in ls:
    print('{0:30}-----{1}'.format(datetime.now().strftime(i[:2]),i))
```

    18                            -----%y 两位数的年份表示（00-99）
    2018                          -----%Y 四位数的年份表示（000-9999）
    07                            -----%m 月份（01-12）
    28                            -----%d 月内中的一天（0-31）
    18                            -----%H 24小时制小时数（0-23）
    06                            -----%I 12小时制小时数（01-12）
    30                            -----%M 分钟数（00=59）
    08                            -----%S 秒（00-59）
    Sat                           -----%a 本地简化星期名称
    Saturday                      -----%A 本地完整星期名称
    Jul                           -----%b 本地简化的月份名称
    July                          -----%B 本地完整的月份名称
    Sat Jul 28 18:30:08 2018      -----%c 本地相应的日期表示和时间表示
    209                           -----%j 年内的一天（001-366）
    PM                            -----%p 本地A.M.或P.M.的等价符
    29                            -----%U 一年中的星期数（00-53）星期天为星期的开始
    6                             -----%w 星期（0-6），星期天为星期的开始
    30                            -----%W 一年中的星期数（00-53）星期一为星期的开始
    07/28/18                      -----%x 本地相应的日期表示
    18:30:08                      -----%X 本地相应的时间表示
                                  -----%Z 当前时区的名称
    %                             -----%% %号本身



```python
datetime.strptime('2018-08-08','%Y-%m-%d')
```




    datetime.datetime(2018, 8, 8, 0, 0)



datetime.strptime是通过已知格式进行日期解析的最佳方式。但是每次都要编写格式定义是很麻烦的事情，尤其是对于一些常见的日期格式。这种情况下，你可以用dateutil这个第三方包中的parser.parse方法（pandas中已经自动安装好了）：


```python
from dateutil.parser import parse
parse('20180818')
```




    datetime.datetime(2018, 8, 18, 0, 0)



在国际通用的格式中，日出现在月的前面很普遍，传入dayfirst=True即可解决这个问题：


```python
parse('06-08-11',dayfirst=True)
```




    datetime.datetime(2011, 8, 6, 0, 0)



pandas通常是用于处理成组日期的，不管这些日期是DataFrame的轴索引还是列。to_datetime方法可以解析多种不同的日期表示形式。


```python
import pandas as pd
dts=['2017-07-07','2018-08-08']
pd.to_datetime(dts)
```




    DatetimeIndex(['2017-07-07', '2018-08-08'], dtype='datetime64[ns]', freq=None)



它还可以处理缺失值（None、空字符串等）：


```python
pd.to_datetime(dts+[None])
```




    DatetimeIndex(['2017-07-07', '2018-08-08', 'NaT'], dtype='datetime64[ns]', freq=None)



NaT（Not a Time）是pandas中时间戳数据的null值。<br>


```python
import tushare as ts
df=ts.get_k_data('600519',start='2018-05-05')
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>134</th>
      <td>2018-07-23</td>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>135</th>
      <td>2018-07-24</td>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>136</th>
      <td>2018-07-25</td>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>137</th>
      <td>2018-07-26</td>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>138</th>
      <td>2018-07-27</td>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
type(df.iloc[0,0])
```




    str




```python
pd.to_datetime(df.date).tail()
```




    134   2018-07-23
    135   2018-07-24
    136   2018-07-25
    137   2018-07-26
    138   2018-07-27
    Name: date, dtype: datetime64[ns]




```python
df.date=pd.to_datetime(df.date)
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>134</th>
      <td>2018-07-23</td>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>135</th>
      <td>2018-07-24</td>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>136</th>
      <td>2018-07-25</td>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>137</th>
      <td>2018-07-26</td>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>138</th>
      <td>2018-07-27</td>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.dtypes
```




    date      datetime64[ns]
    open             float64
    close            float64
    high             float64
    low              float64
    volume           float64
    code              object
    dtype: object




```python
df.set_index(keys=['date'],inplace=True)
```


```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07-23</th>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.index
```




    DatetimeIndex(['2018-05-07', '2018-05-08', '2018-05-09', '2018-05-10',
                   '2018-05-11', '2018-05-14', '2018-05-15', '2018-05-16',
                   '2018-05-17', '2018-05-18', '2018-05-21', '2018-05-22',
                   '2018-05-23', '2018-05-24', '2018-05-25', '2018-05-28',
                   '2018-05-29', '2018-05-30', '2018-05-31', '2018-06-01',
                   '2018-06-04', '2018-06-05', '2018-06-06', '2018-06-07',
                   '2018-06-08', '2018-06-11', '2018-06-12', '2018-06-13',
                   '2018-06-14', '2018-06-15', '2018-06-19', '2018-06-20',
                   '2018-06-21', '2018-06-22', '2018-06-25', '2018-06-26',
                   '2018-06-27', '2018-06-28', '2018-06-29', '2018-07-02',
                   '2018-07-03', '2018-07-04', '2018-07-05', '2018-07-06',
                   '2018-07-09', '2018-07-10', '2018-07-11', '2018-07-12',
                   '2018-07-13', '2018-07-16', '2018-07-17', '2018-07-18',
                   '2018-07-19', '2018-07-20', '2018-07-23', '2018-07-24',
                   '2018-07-25', '2018-07-26', '2018-07-27'],
                  dtype='datetime64[ns]', name='date', freq=None)



# 索引、选取、子集构造
当你根据标签索引选取数据时，时间序列和其它的pandas.Series很像：


```python
df.loc[df.index[-1],:]
```




    open         736
    close     738.56
    high       744.3
    low          730
    volume     20913
    code      600519
    Name: 2018-07-27 00:00:00, dtype: object




```python
df.loc['26-07-2018',:]
```




    open       748.9
    close     735.62
    high       748.9
    low       734.23
    volume     23067
    code      600519
    Name: 2018-07-26 00:00:00, dtype: object




```python
df.loc['2018-7',:]#获得指定月份的切片数据
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07-02</th>
      <td>734.52</td>
      <td>711.55</td>
      <td>739.33</td>
      <td>703.00</td>
      <td>37558.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-03</th>
      <td>709.76</td>
      <td>694.92</td>
      <td>715.78</td>
      <td>678.23</td>
      <td>82837.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-04</th>
      <td>692.00</td>
      <td>690.91</td>
      <td>700.00</td>
      <td>688.00</td>
      <td>37990.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-05</th>
      <td>700.00</td>
      <td>702.39</td>
      <td>716.20</td>
      <td>700.00</td>
      <td>47123.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-06</th>
      <td>707.00</td>
      <td>714.12</td>
      <td>720.93</td>
      <td>699.26</td>
      <td>44156.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-09</th>
      <td>720.03</td>
      <td>727.24</td>
      <td>729.86</td>
      <td>719.73</td>
      <td>40572.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-10</th>
      <td>729.00</td>
      <td>725.76</td>
      <td>731.50</td>
      <td>713.33</td>
      <td>29010.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-11</th>
      <td>710.00</td>
      <td>719.58</td>
      <td>724.00</td>
      <td>702.22</td>
      <td>24278.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-12</th>
      <td>718.00</td>
      <td>737.54</td>
      <td>741.17</td>
      <td>718.00</td>
      <td>40170.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-13</th>
      <td>742.30</td>
      <td>746.99</td>
      <td>748.10</td>
      <td>735.12</td>
      <td>28907.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-16</th>
      <td>752.30</td>
      <td>754.68</td>
      <td>764.11</td>
      <td>751.03</td>
      <td>32474.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-17</th>
      <td>757.00</td>
      <td>742.43</td>
      <td>757.00</td>
      <td>736.02</td>
      <td>27806.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-18</th>
      <td>742.43</td>
      <td>737.44</td>
      <td>749.69</td>
      <td>735.00</td>
      <td>24521.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-19</th>
      <td>739.00</td>
      <td>740.95</td>
      <td>743.95</td>
      <td>735.02</td>
      <td>18078.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-20</th>
      <td>741.50</td>
      <td>741.13</td>
      <td>743.13</td>
      <td>728.00</td>
      <td>30548.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-23</th>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.loc['2018',:]# 获得指定年份的切片数据
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-14</th>
      <td>713.864</td>
      <td>732.016</td>
      <td>732.598</td>
      <td>713.864</td>
      <td>51014.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-15</th>
      <td>735.556</td>
      <td>732.657</td>
      <td>735.990</td>
      <td>723.724</td>
      <td>38055.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-16</th>
      <td>729.640</td>
      <td>724.237</td>
      <td>735.221</td>
      <td>723.014</td>
      <td>30795.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-17</th>
      <td>724.828</td>
      <td>717.197</td>
      <td>727.175</td>
      <td>713.864</td>
      <td>28517.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-18</th>
      <td>713.854</td>
      <td>728.970</td>
      <td>730.626</td>
      <td>711.093</td>
      <td>29255.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-21</th>
      <td>733.584</td>
      <td>724.533</td>
      <td>736.838</td>
      <td>722.225</td>
      <td>29059.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-22</th>
      <td>724.927</td>
      <td>729.216</td>
      <td>729.482</td>
      <td>719.800</td>
      <td>16998.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-23</th>
      <td>729.640</td>
      <td>713.647</td>
      <td>729.640</td>
      <td>713.450</td>
      <td>28268.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-24</th>
      <td>709.920</td>
      <td>705.384</td>
      <td>718.459</td>
      <td>703.018</td>
      <td>30416.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-25</th>
      <td>702.032</td>
      <td>706.824</td>
      <td>716.822</td>
      <td>702.032</td>
      <td>26511.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-28</th>
      <td>707.948</td>
      <td>730.034</td>
      <td>730.291</td>
      <td>705.108</td>
      <td>42805.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-29</th>
      <td>728.457</td>
      <td>721.190</td>
      <td>739.500</td>
      <td>721.042</td>
      <td>40820.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-30</th>
      <td>717.039</td>
      <td>715.708</td>
      <td>726.978</td>
      <td>709.969</td>
      <td>37147.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-31</th>
      <td>720.027</td>
      <td>740.614</td>
      <td>741.097</td>
      <td>720.017</td>
      <td>71852.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-01</th>
      <td>740.614</td>
      <td>734.679</td>
      <td>744.410</td>
      <td>728.417</td>
      <td>36177.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-04</th>
      <td>741.817</td>
      <td>771.022</td>
      <td>771.939</td>
      <td>735.438</td>
      <td>73805.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-05</th>
      <td>775.489</td>
      <td>777.017</td>
      <td>783.574</td>
      <td>766.349</td>
      <td>52629.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-06</th>
      <td>776.968</td>
      <td>774.750</td>
      <td>789.737</td>
      <td>771.348</td>
      <td>48969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-07</th>
      <td>778.920</td>
      <td>770.036</td>
      <td>784.412</td>
      <td>767.995</td>
      <td>39167.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-08</th>
      <td>769.080</td>
      <td>767.059</td>
      <td>774.897</td>
      <td>759.220</td>
      <td>34958.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-11</th>
      <td>765.185</td>
      <td>764.870</td>
      <td>774.996</td>
      <td>757.573</td>
      <td>36547.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-12</th>
      <td>767.108</td>
      <td>788.001</td>
      <td>792.251</td>
      <td>765.629</td>
      <td>55287.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-13</th>
      <td>788.800</td>
      <td>779.265</td>
      <td>791.383</td>
      <td>777.836</td>
      <td>35244.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-14</th>
      <td>778.940</td>
      <td>775.124</td>
      <td>782.687</td>
      <td>764.328</td>
      <td>36159.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-15</th>
      <td>773.200</td>
      <td>773.330</td>
      <td>778.580</td>
      <td>769.100</td>
      <td>31707.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-19</th>
      <td>769.000</td>
      <td>738.000</td>
      <td>769.000</td>
      <td>737.000</td>
      <td>60195.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-20</th>
      <td>741.000</td>
      <td>763.590</td>
      <td>765.000</td>
      <td>741.000</td>
      <td>45838.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-21</th>
      <td>765.220</td>
      <td>759.320</td>
      <td>778.890</td>
      <td>758.770</td>
      <td>39182.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-22</th>
      <td>754.000</td>
      <td>766.530</td>
      <td>767.000</td>
      <td>750.000</td>
      <td>28854.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-25</th>
      <td>766.000</td>
      <td>765.560</td>
      <td>778.970</td>
      <td>764.900</td>
      <td>32934.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-26</th>
      <td>765.310</td>
      <td>754.800</td>
      <td>769.880</td>
      <td>747.000</td>
      <td>46577.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-27</th>
      <td>752.000</td>
      <td>722.440</td>
      <td>757.000</td>
      <td>721.000</td>
      <td>57298.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-28</th>
      <td>714.000</td>
      <td>710.930</td>
      <td>719.000</td>
      <td>697.000</td>
      <td>50833.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-29</th>
      <td>712.300</td>
      <td>731.460</td>
      <td>732.300</td>
      <td>705.000</td>
      <td>32929.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-02</th>
      <td>734.520</td>
      <td>711.550</td>
      <td>739.330</td>
      <td>703.000</td>
      <td>37558.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-03</th>
      <td>709.760</td>
      <td>694.920</td>
      <td>715.780</td>
      <td>678.230</td>
      <td>82837.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-04</th>
      <td>692.000</td>
      <td>690.910</td>
      <td>700.000</td>
      <td>688.000</td>
      <td>37990.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-05</th>
      <td>700.000</td>
      <td>702.390</td>
      <td>716.200</td>
      <td>700.000</td>
      <td>47123.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-06</th>
      <td>707.000</td>
      <td>714.120</td>
      <td>720.930</td>
      <td>699.260</td>
      <td>44156.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-09</th>
      <td>720.030</td>
      <td>727.240</td>
      <td>729.860</td>
      <td>719.730</td>
      <td>40572.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-10</th>
      <td>729.000</td>
      <td>725.760</td>
      <td>731.500</td>
      <td>713.330</td>
      <td>29010.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-11</th>
      <td>710.000</td>
      <td>719.580</td>
      <td>724.000</td>
      <td>702.220</td>
      <td>24278.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-12</th>
      <td>718.000</td>
      <td>737.540</td>
      <td>741.170</td>
      <td>718.000</td>
      <td>40170.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-13</th>
      <td>742.300</td>
      <td>746.990</td>
      <td>748.100</td>
      <td>735.120</td>
      <td>28907.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-16</th>
      <td>752.300</td>
      <td>754.680</td>
      <td>764.110</td>
      <td>751.030</td>
      <td>32474.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-17</th>
      <td>757.000</td>
      <td>742.430</td>
      <td>757.000</td>
      <td>736.020</td>
      <td>27806.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-18</th>
      <td>742.430</td>
      <td>737.440</td>
      <td>749.690</td>
      <td>735.000</td>
      <td>24521.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-19</th>
      <td>739.000</td>
      <td>740.950</td>
      <td>743.950</td>
      <td>735.020</td>
      <td>18078.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-20</th>
      <td>741.500</td>
      <td>741.130</td>
      <td>743.130</td>
      <td>728.000</td>
      <td>30548.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-23</th>
      <td>736.000</td>
      <td>732.070</td>
      <td>741.150</td>
      <td>720.010</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>732.680</td>
      <td>745.400</td>
      <td>747.300</td>
      <td>723.000</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>746.950</td>
      <td>743.810</td>
      <td>749.880</td>
      <td>740.010</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>748.900</td>
      <td>735.620</td>
      <td>748.900</td>
      <td>734.230</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>736.000</td>
      <td>738.560</td>
      <td>744.300</td>
      <td>730.000</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.loc['2018-06-01':'2018-06-15',:]#获得指定时间段的切片，且包含收尾数据行
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-06-01</th>
      <td>740.614</td>
      <td>734.679</td>
      <td>744.410</td>
      <td>728.417</td>
      <td>36177.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-04</th>
      <td>741.817</td>
      <td>771.022</td>
      <td>771.939</td>
      <td>735.438</td>
      <td>73805.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-05</th>
      <td>775.489</td>
      <td>777.017</td>
      <td>783.574</td>
      <td>766.349</td>
      <td>52629.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-06</th>
      <td>776.968</td>
      <td>774.750</td>
      <td>789.737</td>
      <td>771.348</td>
      <td>48969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-07</th>
      <td>778.920</td>
      <td>770.036</td>
      <td>784.412</td>
      <td>767.995</td>
      <td>39167.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-08</th>
      <td>769.080</td>
      <td>767.059</td>
      <td>774.897</td>
      <td>759.220</td>
      <td>34958.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-11</th>
      <td>765.185</td>
      <td>764.870</td>
      <td>774.996</td>
      <td>757.573</td>
      <td>36547.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-12</th>
      <td>767.108</td>
      <td>788.001</td>
      <td>792.251</td>
      <td>765.629</td>
      <td>55287.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-13</th>
      <td>788.800</td>
      <td>779.265</td>
      <td>791.383</td>
      <td>777.836</td>
      <td>35244.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-14</th>
      <td>778.940</td>
      <td>775.124</td>
      <td>782.687</td>
      <td>764.328</td>
      <td>36159.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-06-15</th>
      <td>773.200</td>
      <td>773.330</td>
      <td>778.580</td>
      <td>769.100</td>
      <td>31707.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.loc['2018-06-30':,:]# 获得指定首尾到相关界限的数据
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07-02</th>
      <td>734.52</td>
      <td>711.55</td>
      <td>739.33</td>
      <td>703.00</td>
      <td>37558.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-03</th>
      <td>709.76</td>
      <td>694.92</td>
      <td>715.78</td>
      <td>678.23</td>
      <td>82837.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-04</th>
      <td>692.00</td>
      <td>690.91</td>
      <td>700.00</td>
      <td>688.00</td>
      <td>37990.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-05</th>
      <td>700.00</td>
      <td>702.39</td>
      <td>716.20</td>
      <td>700.00</td>
      <td>47123.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-06</th>
      <td>707.00</td>
      <td>714.12</td>
      <td>720.93</td>
      <td>699.26</td>
      <td>44156.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-09</th>
      <td>720.03</td>
      <td>727.24</td>
      <td>729.86</td>
      <td>719.73</td>
      <td>40572.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-10</th>
      <td>729.00</td>
      <td>725.76</td>
      <td>731.50</td>
      <td>713.33</td>
      <td>29010.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-11</th>
      <td>710.00</td>
      <td>719.58</td>
      <td>724.00</td>
      <td>702.22</td>
      <td>24278.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-12</th>
      <td>718.00</td>
      <td>737.54</td>
      <td>741.17</td>
      <td>718.00</td>
      <td>40170.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-13</th>
      <td>742.30</td>
      <td>746.99</td>
      <td>748.10</td>
      <td>735.12</td>
      <td>28907.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-16</th>
      <td>752.30</td>
      <td>754.68</td>
      <td>764.11</td>
      <td>751.03</td>
      <td>32474.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-17</th>
      <td>757.00</td>
      <td>742.43</td>
      <td>757.00</td>
      <td>736.02</td>
      <td>27806.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-18</th>
      <td>742.43</td>
      <td>737.44</td>
      <td>749.69</td>
      <td>735.00</td>
      <td>24521.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-19</th>
      <td>739.00</td>
      <td>740.95</td>
      <td>743.95</td>
      <td>735.02</td>
      <td>18078.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-20</th>
      <td>741.50</td>
      <td>741.13</td>
      <td>743.13</td>
      <td>728.00</td>
      <td>30548.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-23</th>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.loc[df.index[[0,2,4]],:]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>



# 检查重复索引的时间序列


```python
df.index.is_unique
```




    True



# 生成日期范围
pandas.date_range可用于根据指定的频率生成指定长度的DatetimeIndex


```python
index=pd.date_range('20180808','2018/8/18')
index
```




    DatetimeIndex(['2018-08-08', '2018-08-09', '2018-08-10', '2018-08-11',
                   '2018-08-12', '2018-08-13', '2018-08-14', '2018-08-15',
                   '2018-08-16', '2018-08-17', '2018-08-18'],
                  dtype='datetime64[ns]', freq='D')




```python
pd.date_range(start='20180808',periods=5)
```




    DatetimeIndex(['2018-08-08', '2018-08-09', '2018-08-10', '2018-08-11',
                   '2018-08-12'],
                  dtype='datetime64[ns]', freq='D')



生成一个由每月最后一个工作日组成的日期索引，可以传入"BM"频率,样就只会包含时间间隔内（或刚好在边界上的）符合频率要求的日期：


```python
pd.date_range(start='20170831',end='2018-05-31',freq='BM')
```




    DatetimeIndex(['2017-08-31', '2017-09-29', '2017-10-31', '2017-11-30',
                   '2017-12-29', '2018-01-31', '2018-02-28', '2018-03-30',
                   '2018-04-30', '2018-05-31'],
                  dtype='datetime64[ns]', freq='BM')



基本的时间序列频率:
![image.png](30._pandas时间序列_files/image.png)

![image.png](30._pandas时间序列_files/image.png)

![image.png](30._pandas时间序列_files/image.png)
有时，虽然起始和结束日期带有时间信息，但你希望产生一组被规范化（normalize）到午夜的时间戳。normalize选项即可实现该功能：


```python
pd.date_range('2012-05-02 12:56:31', periods=5, normalize=True)
```




    DatetimeIndex(['2012-05-02', '2012-05-03', '2012-05-04', '2012-05-05',
                   '2012-05-06'],
                  dtype='datetime64[ns]', freq='D')



# 频率和日期偏移量
pandas中的频率是由一个基础频率（base frequency）和一个乘数组成的。基础频率通常以一个字符串别名表示，比如"M"表示每月，"H"表示每小时。对于每个基础频率，都有一个被称为日期偏移量（date offset）的对象与之对应。例如，按小时计算的频率可以用Hour类表示：


```python
from pandas.tseries.offsets import Hour,Minute
```


```python
Hour()
```




    <Hour>




```python
Hour(5)
```




    <5 * Hours>



一般来说，无需明确创建这样的对象，只需使用诸如"H"或"4H"这样的字符串别名即可。在基础频率前面放上一个整数即可创建倍数：


```python
pd.date_range('2018-08',periods=5,freq='4H')
```




    DatetimeIndex(['2018-08-01 00:00:00', '2018-08-01 04:00:00',
                   '2018-08-01 08:00:00', '2018-08-01 12:00:00',
                   '2018-08-01 16:00:00'],
                  dtype='datetime64[ns]', freq='4H')



大部分偏移量对象都可通过加法进行连接


```python
Hour(3)+Minute(20)
```




    <200 * Minutes>



同理，你也可以传入频率字符串（如"2h30min"），这种字符串可以被高效地解析为等效的表达式：


```python
pd.date_range('2018-08',periods=5,freq='4H5min')
```




    DatetimeIndex(['2018-08-01 00:00:00', '2018-08-01 04:05:00',
                   '2018-08-01 08:10:00', '2018-08-01 12:15:00',
                   '2018-08-01 16:20:00'],
                  dtype='datetime64[ns]', freq='245T')



# WOM日期
WOM（Week Of Month）是一种非常实用的频率类，它以WOM开头。它使你能获得诸如“每月第3个星期五”之类的日期：


```python
pd.date_range('2012-01-01', '2012-09-01', freq='WOM-3FRI')
```




    DatetimeIndex(['2012-01-20', '2012-02-17', '2012-03-16', '2012-04-20',
                   '2012-05-18', '2012-06-15', '2012-07-20', '2012-08-17'],
                  dtype='datetime64[ns]', freq='WOM-3FRI')



# 移动（超前和滞后）数据
移动（shifting）指的是沿着时间轴将数据前移或后移。Series和DataFrame都有一个shift方法用于执行单纯的前移或后移操作，保持索引不变：


```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.shift(2).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-05-08</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07-23</th>
      <td>736.00</td>
      <td>732.07</td>
      <td>741.15</td>
      <td>720.01</td>
      <td>35969.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>732.68</td>
      <td>745.40</td>
      <td>747.30</td>
      <td>723.00</td>
      <td>41808.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.shift(-2).tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07-23</th>
      <td>746.95</td>
      <td>743.81</td>
      <td>749.88</td>
      <td>740.01</td>
      <td>21743.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-24</th>
      <td>748.90</td>
      <td>735.62</td>
      <td>748.90</td>
      <td>734.23</td>
      <td>23067.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-25</th>
      <td>736.00</td>
      <td>738.56</td>
      <td>744.30</td>
      <td>730.00</td>
      <td>20913.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-07-26</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-07-27</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



当我们这样进行移动时，就会在时间序列的前面或后面产生缺失数据。

shift通常用于计算一个时间序列或多个时间序列（如DataFrame的列）中的百分比变化。可以这样表达：


```python
(df.iloc[:,[1]]/df.iloc[:,[1]].shift(1)-1).head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>close</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-05-08</th>
      <td>0.015267</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>-0.009705</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>0.017436</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>0.005364</td>
    </tr>
  </tbody>
</table>
</div>



由于单纯的移位操作不会修改索引，所以部分数据会被丢弃。因此，如果频率已知，则可以将其传给shift以便实现对时间戳进行位移而不是对数据进行简单位移：


```python
df.shift(1,freq='1D').head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-08</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-12</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>



# 重采样及频率转换 
重采样（resampling）指的是将时间序列从一个频率转换到另一个频率的处理过程。将高频率数据聚合到低频率称为降采样（downsampling），而将低频率数据转换到高频率则称为升采样（upsampling）。<br>
pandas对象都带有一个resample方法，它是各种频率转换工作的主力函数。resample有一个类似于groupby的API，调用resample可以分组数据，然后会调用一个聚合函数：


```python
df.resample('1W').mean().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-13</th>
      <td>688.0802</td>
      <td>698.3168</td>
      <td>704.5582</td>
      <td>684.7020</td>
      <td>51770.6</td>
    </tr>
    <tr>
      <th>2018-05-20</th>
      <td>723.5484</td>
      <td>727.0154</td>
      <td>732.3220</td>
      <td>717.1118</td>
      <td>35527.2</td>
    </tr>
    <tr>
      <th>2018-05-27</th>
      <td>720.0206</td>
      <td>715.9208</td>
      <td>726.2482</td>
      <td>712.1050</td>
      <td>26250.4</td>
    </tr>
    <tr>
      <th>2018-06-03</th>
      <td>722.8170</td>
      <td>728.4450</td>
      <td>736.4552</td>
      <td>716.9106</td>
      <td>45760.2</td>
    </tr>
    <tr>
      <th>2018-06-10</th>
      <td>768.4548</td>
      <td>771.9768</td>
      <td>780.9118</td>
      <td>760.0700</td>
      <td>49905.6</td>
    </tr>
  </tbody>
</table>
</div>



 resample方法的参数:
 ![image.png](30._pandas时间序列_files/image.png)
 # 降采样
将数据聚合到规律的低频率是一件非常普通的时间序列处理任务。待聚合的数据不必拥有固定的频率，期望的频率会自动定义聚合的面元边界，这些面元用于将时间序列拆分为多个片段。例如，要转换到月度频率（'M'或'BM'），数据需要被划分到多个单月时间段中。各时间段都是半开放的。一个数据点只能属于一个时间段，所有时间段的并集必须能组成整个时间帧。在用resample对数据进行降采样时，需要考虑两样东西：
* 各区间哪边是闭合的。
* 如何标记各个聚合面元，用区间的开头还是末尾。


```python
df.resample('2W',closed='right',label='right').sum()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-13</th>
      <td>3440.401</td>
      <td>3491.584</td>
      <td>3522.791</td>
      <td>3423.510</td>
      <td>258853.0</td>
    </tr>
    <tr>
      <th>2018-05-27</th>
      <td>7217.845</td>
      <td>7214.681</td>
      <td>7292.851</td>
      <td>7146.084</td>
      <td>308888.0</td>
    </tr>
    <tr>
      <th>2018-06-10</th>
      <td>7456.359</td>
      <td>7502.109</td>
      <td>7586.835</td>
      <td>7384.903</td>
      <td>478329.0</td>
    </tr>
    <tr>
      <th>2018-06-24</th>
      <td>6902.453</td>
      <td>6908.030</td>
      <td>6999.787</td>
      <td>6821.236</td>
      <td>369013.0</td>
    </tr>
    <tr>
      <th>2018-07-08</th>
      <td>7252.890</td>
      <td>7199.080</td>
      <td>7349.390</td>
      <td>7103.390</td>
      <td>470235.0</td>
    </tr>
    <tr>
      <th>2018-07-22</th>
      <td>7351.560</td>
      <td>7373.740</td>
      <td>7432.510</td>
      <td>7273.470</td>
      <td>296364.0</td>
    </tr>
    <tr>
      <th>2018-08-05</th>
      <td>3700.530</td>
      <td>3695.460</td>
      <td>3731.530</td>
      <td>3647.250</td>
      <td>143500.0</td>
    </tr>
  </tbody>
</table>
</div>



# OHLC重采样
金融领域中有一种无所不在的时间序列聚合方式，即计算各面元的四个值：第一个值（open，开盘）、最后一个值（close，收盘）、最大值（high，最高）以及最小值（low，最低）。传入how='ohlc'即可得到一个含有这四种聚合值的DataFrame。整个过程很高效，只需一次扫描即可计算出结果：


```python
df.close.resample('2W').ohlc()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-13</th>
      <td>688.396</td>
      <td>707.968</td>
      <td>688.396</td>
      <td>707.968</td>
    </tr>
    <tr>
      <th>2018-05-27</th>
      <td>732.016</td>
      <td>732.657</td>
      <td>705.384</td>
      <td>706.824</td>
    </tr>
    <tr>
      <th>2018-06-10</th>
      <td>730.034</td>
      <td>777.017</td>
      <td>715.708</td>
      <td>767.059</td>
    </tr>
    <tr>
      <th>2018-06-24</th>
      <td>764.870</td>
      <td>788.001</td>
      <td>738.000</td>
      <td>766.530</td>
    </tr>
    <tr>
      <th>2018-07-08</th>
      <td>765.560</td>
      <td>765.560</td>
      <td>690.910</td>
      <td>714.120</td>
    </tr>
    <tr>
      <th>2018-07-22</th>
      <td>727.240</td>
      <td>754.680</td>
      <td>719.580</td>
      <td>741.130</td>
    </tr>
    <tr>
      <th>2018-08-05</th>
      <td>732.070</td>
      <td>745.400</td>
      <td>732.070</td>
      <td>738.560</td>
    </tr>
  </tbody>
</table>
</div>



# 升采样和插值


```python
df.resample('12H').asfreq().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07 00:00:00</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-07 12:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-05-08 00:00:00</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08 12:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2018-05-09 00:00:00</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.resample('12H').ffill().head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07 00:00:00</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-07 12:00:00</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08 00:00:00</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08 12:00:00</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09 00:00:00</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.resample('12H').ffill(limit=2).head(11)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>close</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>code</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-05-07 00:00:00</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-07 12:00:00</th>
      <td>650.711</td>
      <td>688.396</td>
      <td>692.054</td>
      <td>648.561</td>
      <td>85591.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08 00:00:00</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-08 12:00:00</th>
      <td>688.258</td>
      <td>698.906</td>
      <td>702.160</td>
      <td>688.258</td>
      <td>62497.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09 00:00:00</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-09 12:00:00</th>
      <td>699.153</td>
      <td>692.123</td>
      <td>702.328</td>
      <td>687.360</td>
      <td>32331.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10 00:00:00</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-10 12:00:00</th>
      <td>693.651</td>
      <td>704.191</td>
      <td>705.976</td>
      <td>693.651</td>
      <td>39293.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11 00:00:00</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-11 12:00:00</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
    <tr>
      <th>2018-05-12 00:00:00</th>
      <td>708.628</td>
      <td>707.968</td>
      <td>720.273</td>
      <td>705.680</td>
      <td>39141.0</td>
      <td>600519</td>
    </tr>
  </tbody>
</table>
</div>



# 移动窗口函数
在移动窗口（可以带有指数衰减权数）上计算的各种统计函数也是一类常见于时间序列的数组变换。这样可以圆滑噪音数据或断裂数据。我将它们称为移动窗口函数（moving window function），其中还包括那些窗口不定长的函数（如指数加权移动平均）。跟其他统计函数一样，移动窗口函数也会自动排除缺失值。<br>
它与resample和groupby很像。


```python
import matplotlib.pyplot as plt
df.close.plot(label='close')
df.close.rolling(window=10,min_periods=0).mean().plot(label='ma10')
plt.legend()
```




    <matplotlib.legend.Legend at 0x22e2fe144e0>




    
![png](30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_files/30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_83_1.png)
    


rolling函数也可以接受一个指定固定大小时间补偿字符串，而不是一组时期。这样可以方便处理不规律的时间序列。这些字符串也可以传递给resample。


```python
df.close.plot(label='close')
df.close.rolling(window='20D').mean().plot(label='ma20')
plt.legend()
```




    <matplotlib.legend.Legend at 0x22e2ff40c18>




    
![png](30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_files/30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_85_1.png)
    


# 指数加权函数
另一种使用固定大小窗口及相等权数观测值的办法是，定义一个衰减因子（decay factor）常量，以便使近期的观测值拥有更大的权数。衰减因子的定义方式有很多，比较流行的是使用时间间隔（span），它可以使结果兼容于窗口大小等于时间间隔的简单移动窗口（simple moving window）函数。<br>

由于指数加权统计会赋予近期的观测值更大的权数，因此相对于等权统计，它能“适应”更快的变化。


```python
df.close.plot(style='k-',label='close')
df.close.rolling(window=10,min_periods=0).mean().plot(style='r--',label='rolling')
df.close.ewm(span=10).mean().plot(style='g.',label='ewm')
plt.legend()
```




    <matplotlib.legend.Legend at 0x22e2ffd6ef0>




    
![png](30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_files/30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_87_1.png)
    


# 二元移动窗口函数
有些统计运算（如相关系数和协方差）需要在两个时间序列上执行。例如，金融分析师常常对某只股票对某个参考指数（如标准普尔500指数）的相关系数感兴趣。


```python
df.close.rolling(window=10,min_periods=0).corr(df.volume).plot()
```




    <matplotlib.axes._subplots.AxesSubplot at 0x22e2ffb15c0>




    
![png](30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_files/30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_89_1.png)
    


# 用户定义的移动窗口函数
rolling_apply函数使你能够在移动窗口上应用自己设计的数组函数。唯一要求的就是：该函数要能从数组的各个片段中产生单个值（即约简）。


```python
df.close.plot()
df.close.rolling(window=10,min_periods=0).apply(lambda x:x.max(),raw=True).plot()
plt.legend()
```




    <matplotlib.legend.Legend at 0x22e310b95f8>




    
![png](30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_files/30._pandas%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97_91_1.png)
    

