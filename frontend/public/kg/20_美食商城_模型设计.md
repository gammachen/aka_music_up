为了构建一个支持**多维度检索（如城市、地址、距离等）的美食或外卖商城系统**，我们需要设计一套完整的实体模型。以下是该系统中常见的核心实体及其属性和关系。

---

## 🧩 一、主要实体（Entities）

### 1. 用户（User）
代表平台的使用者，可以是下单用户或商家管理员。

- **属性**：
  - `id`：唯一标识
  - `username`：用户名
  - `phone`：手机号
  - `email`：邮箱
  - `passwordHash`：密码哈希
  - `registerTime`：注册时间
  - `defaultAddressId`：默认收货地址ID

---

### 2. 地址（Address）
用户的收货地址或配送地址信息。

- **属性**：
  - `id`
  - `userId`
  - `name`：联系人姓名
  - `phone`
  - `province`：省
  - `city`：市
  - `district`：区
  - `street`：街道详细地址
  - `latitude`：纬度（用于计算距离）
  - `longitude`：经度
  - `isDefault`：是否为默认地址

---

### 3. 商家（Restaurant / Merchant）
提供外卖服务的餐厅/店铺。

- **属性**：
  - `id`
  - `name`
  - `description`
  - `address`：营业地址
  - `phone`
  - `logoUrl`
  - `openHours`：营业时间（例如 "09:00-22:00"）
  - `rating`：评分
  - `deliveryFee`：配送费
  - `minOrderAmount`：起送金额
  - `status`：营业状态（营业/休息/打烊）
  - `latitude`
  - `longitude`

---

### 4. 餐品（FoodItem / MenuItem）
菜单中的具体菜品或商品。

- **属性**：
  - `id`
  - `restaurantId`
  - `name`
  - `description`
  - `price`
  - `category`：分类（主食、饮料、甜点等）
  - `imageUrls`：图片列表
  - `available`：是否在售
  - `salesCount`：销量

---

### 5. 订单（Order）
用户下的订单记录。

- **属性**：
  - `id`
  - `userId`
  - `restaurantId`
  - `totalPrice`
  - `orderTime`
  - `deliveryAddressId`
  - `status`：待支付、已支付、配送中、已完成、已取消
  - `deliveryType`：自提/配送
  - `paymentMethod`：支付方式

---

### 6. 订单项（OrderItem）
订单中每一项的具体餐品信息。

- **属性**：
  - `id`
  - `orderId`
  - `foodItemId`
  - `quantity`
  - `unitPrice`
  - `note`：备注（如“不要辣”）

---

### 7. 分类（Category）
用于对商家或餐品进行分类。

- **属性**：
  - `id`
  - `name`（如“中式快餐”、“西式简餐”、“奶茶”、“火锅”等）
  - `type`（可选：`restaurant` 或 `food`）

---

### 8. 标签（Tag）
用于精细化标签管理，提升搜索与推荐能力。

- **属性**：
  - `id`
  - `name`（如“清真”、“无糖”、“低脂”、“网红店”、“免配送费”等）

---

### 9. 收藏（Favorite）
用户收藏的商家或餐品。

- **属性**：
  - `userId`
  - `targetId`：目标ID（可能是 Restaurant 或 FoodItem）
  - `targetType`：类型（`restaurant` / `food`）
  - `favoriteTime`

---

### 10. 搜索历史（SearchHistory）
记录用户的搜索行为。

- **属性**：
  - `userId`
  - `searchKeyword`
  - `searchTime`

---

### 11. 优惠券 / 促销活动（Promotion / Coupon）
营销相关的实体。

- **属性**：
  - `id`
  - `title`：优惠标题
  - `description`
  - `discountType`：满减、折扣、固定金额
  - `amount`：优惠金额或比例
  - `validFrom`, `validTo`：有效期
  - `applicableTo`：适用对象（所有用户、新用户、特定商家等）

---

### 12. 评价（Review / Comment）
用户对订单或商家的评价。

- **属性**：
  - `id`
  - `userId`
  - `restaurantId`
  - `orderId`（可选）
  - `content`
  - `rating`：评分（1~5）
  - `images`：评论配图
  - `commentTime`

---

## 🔗 二、主要关系（Relationships）

| 关系名称             | 起始节点         | 目标节点       | 描述说明                           |
|----------------------|------------------|----------------|------------------------------------|
| `LIVES_AT`           | User             | Address        | 用户居住地址                       |
| `DELIVER_TO`         | Order            | Address        | 订单送达地址                       |
| `HAS_MENU`           | Restaurant       | FoodItem       | 商家拥有的菜单                     |
| `BELONGS_TO`         | FoodItem         | Category       | 餐品属于某个分类                   |
| `TAGGED_WITH`        | Restaurant/Food  | Tag            | 打标签                             |
| `FAVORITES`          | User             | Restaurant/Food| 用户收藏商家或餐品                 |
| `CONTAINS`           | Order            | OrderItem      | 订单包含多个订单项                 |
| `PLACED_ORDER`       | User             | Order          | 用户下单                           |
| `ASSOCIATED_WITH`    | Promotion        | Restaurant     | 优惠关联到某商家                   |
| `WRITES_REVIEW`      | User             | Review         | 用户写评价                         |

---

## 🔍 三、支持的多维检索功能及实现思路

| 检索维度     | 实体/字段支撑                  | 示例查询语句关键词                |
|--------------|-------------------------------|-----------------------------------|
| 城市/地区    | Address.city, Restaurant.city | WHERE city = '北京'               |
| 地址         | Address.street                | WHERE street CONTAINS '中关村'    |
| 距离         | latitude, longitude           | ORDER BY distance(location1, location2) |
| 商家分类     | Category.name                 | WHERE category = '西餐'           |
| 餐品种类     | FoodItem.category              | WHERE food.category = '饮品'      |
| 价格区间     | FoodItem.price                | WHERE price BETWEEN 10 AND 30     |
| 评分排序     | Restaurant.rating              | ORDER BY rating DESC              |
| 是否在营业   | Restaurant.status             | WHERE status = '营业中'           |
| 标签筛选     | Tag.name                      | WHERE tag IN ['免配送费', '清真'] |
| 收藏优先     | Favorite.userId               | MATCH (u)-[:FAVORITES]->(r)       |
| 历史搜索词   | SearchHistory.searchKeyword   | RETURN DISTINCT keyword           |

---

## ✅ 四、扩展建议（高级功能）

| 功能模块       | 可引入实体/关系             |
|----------------|------------------------------|
| 推荐系统       | 用户偏好、协同过滤模型       |
| 多语言支持     | i18n 字段                    |
| 多仓库/分店    | RestaurantGroup + Branch     |
| 即时聊天系统   | Message + ChatRoom           |
| 配送员系统     | DeliveryPerson + DeliveryLog |
| 数据分析仪表板 | 统计数据聚合节点             |

---

## 🧭 总结

关键元素：

- **用户中心**：地址、订单、收藏、评价
- **商家中心**：菜单、分类、运营状态
- **搜索与推荐引擎**：支持基于地理位置、分类、标签、价格等多维检索
- **地理信息处理**：经纬度 + 距离算法
- **高性能读写分离**：高频操作如搜索、下单、收藏等需优化性能

