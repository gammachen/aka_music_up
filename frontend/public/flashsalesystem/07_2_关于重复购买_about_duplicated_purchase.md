### 秒杀系统中的重复下单定义
在秒杀场景中，**重复下单**指同一用户对同一商品在短时间内（如系统未完成订单创建的间隙）多次成功提交订单，导致生成多个有效订单的现象。这通常违背秒杀业务“同一用户限购一件”的核心规则，可能引发库存超卖、用户投诉或系统异常。

### 重复下单的典型场景
#### 1. **前端防重失效**
   - **用户操作**：用户因网络延迟未收到即时反馈，快速多次点击“提交订单”按钮。
   - **技术原因**：前端未禁用按钮、未生成唯一请求Token或未拦截重复表单提交。
   - **示例**：用户连续点击购买按钮，浏览器发送多个下单请求至后端。

#### 2. **后端接口缺乏幂等性设计**
   - **直接插入订单**：后端未对用户ID+商品ID做唯一性校验，直接执行`INSERT`操作。
   - **自增ID漏洞**：依赖数据库自增主键而非业务唯一键（如订单号），导致重复数据插入。
   - **示例**：同一用户的两次请求均通过校验，生成两个不同订单号的记录。

#### 3. **网络问题引发重试**
   - **请求超时重试**：用户因页面卡顿手动刷新，或客户端自动重试失败请求。
   - **分布式系统延迟**：秒杀网关与订单服务间网络波动，导致消息重传。
   - **示例**：用户首次下单因网络延迟未收到响应，再次点击后系统处理两次请求。

#### 4. **分布式系统状态不一致**
   - **Session共享问题**：用户登录态在分布式节点间未同步，误判为新用户。
   - **库存与订单解耦**：采用“预扣库存+异步创建订单”模式时，若订单创建失败但未回滚库存，可能触发重复扣减。
   - **示例**：库存服务已扣减库存，但订单服务因故障未生成订单，用户重试后再次扣减库存。

#### 5. **恶意刷单行为**
   - **自动化工具**：黑产通过脚本模拟用户行为，绕过前端限制高频下单。
   - **多设备协同**：同一用户使用多终端或账号绕过限购策略。
   - **示例**：刷单脚本在1秒内发送数百次请求，远超人工操作频率。

### 预防重复下单的核心措施（简要补充）
- **前端防重**：提交后禁用按钮、生成唯一Token校验。
- **后端幂等**：通过订单号+用户ID建立唯一索引，或采用`INSERT ... ON DUPLICATE KEY UPDATE`。
- **分布式锁**：对用户ID+商品ID加锁，确保同一时间仅一个请求处理。
- **库存预占**：下单时直接锁定库存，避免异步流程中的状态不一致。

重复下单的本质是**高并发场景下系统对用户行为的容错能力不足**，需通过前后端协同防护与分布式事务设计综合解决。


