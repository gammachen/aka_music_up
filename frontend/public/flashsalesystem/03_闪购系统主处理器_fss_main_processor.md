以下是使用 **Mermaid** 绘制的秒杀系统业务流程时序图，分为 **商品详情展示流程** 和 **支付流程**，并标注了关键系统交互与信息展示节点：

---

### **1. 商品详情展示流程**
```mermaid
sequenceDiagram
    participant 用户 as 用户
    participant 前端 as 前端
    participant 商品服务 as 商品服务
    participant 库存服务 as 库存服务

    用户 ->> 前端: 访问秒杀商品页面
    前端 ->> 商品服务: 查询商品详情(商品ID)
    商品服务 -->> 前端: 返回商品信息(名称、价格、图片)
    前端 ->> 库存服务: 查询实时库存(商品ID)
    库存服务 -->> 前端: 返回剩余库存(如100件)
    前端 -->> 用户: 展示商品页(倒计时、库存)
```

---

### **2. 秒杀资格校验与订单生成流程**
```mermaid
sequenceDiagram
    participant 用户 as 用户
    participant 前端 as 前端
    participant 网关 as 网关
    participant 用户服务 as 用户服务
    participant 风控系统 as 风控系统
    participant 库存服务 as 库存服务
    participant 订单服务 as 订单服务
    participant 优惠券服务 as 优惠券服务
    participant 消息队列 as 消息队列

    用户 ->> 前端: 点击秒杀按钮
    前端 ->> 网关: 提交请求(用户ID, 商品ID)
    网关 ->> 用户服务: 校验用户登录态
    用户服务 -->> 网关: 用户有效
    网关 ->> 风控系统: 校验风险(IP/设备/行为)
    风控系统 -->> 网关: 允许请求
    网关 ->> 库存服务: 预扣库存(原子操作)
    alt 库存预扣成功
        库存服务 -->> 网关: 预扣成功
        网关 ->> 订单服务: 生成订单ID
        订单服务 -->> 网关: 返回订单ID
        网关 ->> 消息队列: 写入订单请求(异步)
        消息队列 ->> 订单服务: 消费请求
        订单服务 ->> 优惠券服务: 校验优惠券(用户ID)
        优惠券服务 -->> 订单服务: 返回优惠金额
        订单服务 ->> 用户服务: 获取用户等级折扣
        用户服务 -->> 订单服务: 返回折扣
        订单服务 ->> 数据库: 生成正式订单
        订单服务 -->> 前端: 返回支付页
        前端 -->> 用户: 展示支付页(金额、倒计时)
    else 库存预扣失败
        库存服务 -->> 网关: 库存不足
        网关 -->> 前端: 返回失败
        前端 -->> 用户: 提示“库存不足”
    end
```

---

### **3. 支付流程**
```mermaid
sequenceDiagram
    participant 用户 as 用户
    participant 前端 as 前端
    participant 支付服务 as 支付服务
    participant 第三方支付 as 第三方支付
    participant 订单服务 as 订单服务
    participant 库存服务 as 库存服务
    participant 商家服务 as 商家服务
    participant 用户服务 as 用户服务

    用户 ->> 前端: 确认支付(选择方式)
    前端 ->> 支付服务: 提交支付请求(订单ID)
    支付服务 ->> 第三方支付: 调用支付接口
    alt 支付成功
        第三方支付 -->> 支付服务: 支付成功
        支付服务 ->> 订单服务: 更新订单状态
        订单服务 ->> 库存服务: 最终扣减库存
        库存服务 -->> 订单服务: 确认扣减
        订单服务 ->> 商家服务: 通知发货
        商家服务 -->> 订单服务: 已接收
        订单服务 ->> 用户服务: 更新用户积分
        用户服务 -->> 订单服务: 积分更新成功
        订单服务 -->> 支付服务: 确认完成
        支付服务 -->> 前端: 返回支付成功
        前端 -->> 用户: 展示成功页(物流信息)
    else 支付失败
        第三方支付 -->> 支付服务: 支付失败
        支付服务 -->> 前端: 返回失败
        前端 -->> 用户: 提示“支付失败”
    end
```

---

### **关键说明**
1. **商品详情流程**  
   - 前端通过缓存和CDN减轻服务端压力。  
   - 实时库存展示直接调用库存服务（Redis缓存）。  

2. **秒杀核心流程**  
   - 通过网关层拦截非法请求（用户验证、风控）。  
   - 库存预扣使用Redis原子操作（`DECR`或Lua脚本）。  
   - 订单生成异步化（消息队列缓冲高并发请求）。  

3. **支付流程**  
   - 支付成功后触发库存最终扣减和商家发货。  
   - 用户积分更新与订单状态同步。  

如果需要调整交互细节（如增加重试机制或更复杂的风控逻辑），可以进一步扩展时序图！

