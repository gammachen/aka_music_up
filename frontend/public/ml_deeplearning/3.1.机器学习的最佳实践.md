<font size=6>机器学习的最佳实践</font>
# 机器学习的最佳实践
最佳实践，是一个管理学概念，认为存在某种技术、方法、过程、活动或机制可以使生产或管理实践的结果达到最优，并减少出错的可能性。

1. 正确规划项目构建流程；
2. 迭代过程中遇到问题的解决方法；
<table>
    <tr>
        <td><img src="images/b87dfe87110ca94eca2aa3b171d71d56.png"></td>
        <td><img src="images/161d983f9cdcc586a5b79b3161721d6c.png"></td>
    </tr>
    <tr>
        <td><img src="images/17f0bfca6e220f338554fb1dec7d9add.png"></td>
        <td><img src="images/62e716e53443c04d65d63ccc6ceba9e8.png"></td>
    </tr>
<table>


# 正交化
正交化的概念就是指，将你可以调整的参数设置在不同的正交(垂直)的维度上，调整其中一个参数，不会或几乎不会影响其他维度上的参数变化，这样在机器学习项目中，可以让你更容易更快速地将参数调整到一个比较好的数值。
## 正交化场景
<img src="images/7f5034517a97e2091be6f5095fdcb978.png">

## 正交化ML
<img src="images/e43a775bf7328d50e9efd02f5ea8b43d.png">

# 单一评估指标
无论是调整超参数，或者是尝试不同的学习算法，或者在搭建机器学习系统时尝试不同手段，如果存在单一的评估指标，那么开发进展会快得多。这是因为，单一评估指标可以快速告诉我们，新尝试的手段比之前的手段好还是差。

## 例1
|分类|查准率|召回率|
|-|-|-|
|A|95%|90%|
|B|98%|85%|

**混淆矩阵：**
<table width=80%>
    <tr>
        <th></th><th>P:正-Positive</th><th>N:负-Negative</th>
    </tr>
    <tr>
        <td>T:真-True</td><td>TP:真正,将正类预测为正类数</td><td>TN:真负,将负类预测为负类数</td>
    </tr>
    <tr>
        <td>F:假-False</td>
        <td>FP:假正,将负类预测为正类数误报 (Type I error)</td>
        <td>FN:假负,将正类预测为负类数漏报 (Type II error)</td>
    </tr>
</table>

**评估指标：**
<table width=80%>
    <tr>
        <th  width=15%>评估指标</th><th>解释</th><th>公式</th>
    </tr>
    <tr>
        <td>准确率</td><td>准确率是我们最常见的评价指标，而且很容易理解，就是被分对的样本数除以所有的样本数，通常来说，正确率越高，分类器越好。</td><td>$Accuracy=\frac{T}{T+F}$</td>
    </tr>
    <tr>
        <td>错误率</td><td>错误率则与准确率相反，描述被分类器错分的比例。</td><td>$Error\_rate=\frac{F}{T+F}=1-Accuracy$</td>
    </tr>   <tr>
        <td>特效度</td><td>表示的是所有负例中被分对的比例，衡量了分类器对负例的识别能力。</td><td>$sensitive=\frac{TN}{N}$</td>
    </tr>    <tr>
        <td>查准率</td><td>表示被分为正例的示例中实际为正例的比例。</td><td>$precision=\frac{TP}{P}$</td>
    </tr>    <tr>
        <td>召回率</td><td>召回率是覆盖面的度量，度量有多个正例被分为正例</td><td>$recall=\frac{TP}{TP+FN}$</td>
    </tr>
</table>

**$F1$值:**

<img src="images/575144df22e455c4269043b1bb3d2d5c.png" width=60%>

**单一评估:**

|分类|查准率|召回率|$F1$值|
|-|-|-|-|
|A|95%|90%|92.4%|
|B|98%|85%|91.0%|

## 例2
求平均值，看平均表现：
<img src="images/d16788ba017b04733720dfe7969ef838.png">

# 满足和优化指标-另外一种多指标评估方法
1. 优化指标作为评估指标，提供模型设定成本值得依据；
2. 满足指标作为过滤器；
3. 先过滤，在评估；
<img src="images/f4574276832597fbc9d5977401896d15.png">

# 训练/开发/测试集
## $train,dev,test$
<img src="images/163d77ba74a55f627d201cd2d9ae8f07.png" width=60%>

## 原则
1. 保证来自于同一分布空间，即子集与全集是同一分布，方法：从全集中随机抽取；
2. 开发和测试集的划分，要考虑项目的应用场景，做到不违反第一原则的情况下，有所倾斜；

# 资源、效率和基准
1. 资源（时间）作为输入，效率（准确率）作为产出，基准代表合格的标准；
2. 以人工的准确率作为基准；
3. 在持续投入下，机器同人工的表现；
    1. 加速追赶阶段；
    2. 到达临界点，得到认可；
    2. 减速超越阶段；
4. 机器效率曲线在临界点前后的不同表现的原因；
    1. 存在理论最优值，投入产出比边际递减；
    3. 人类的表现是经过较长时间进化而来，在绝对值上是被认可的；
    4. 在超越之前，可以及固化人工的方法提高机器表现，超越之后没有这么易得的知识；
    
<img src="images/42053491e39c1b60da8755c035cd4d95.png" width=90%>

## 可避免偏差（Avoidable bias）
1. 偏差是相对于零误差而言；
2. 可避免偏差是相对人工误差而言；
3. 方差是相对于训练误差而言。

### 例
<table>
    <tr>
        <th>指标</th><th>基准误差</th><th>训练误差</th><th>开发/验证误差</th><th>偏差</th><th>方差</th><th>优化点</th>
    </tr><tr>
        <td>例1</td><td>%0</td><td>8%</td><td>10%</td><td>8%</td><td>2%</td><td>优化偏差</td>
    </tr><tr>
        <td>例2</td><td>%4</td><td>8%</td><td>10%</td><td>4%</td><td>2%</td><td>优化偏差</td>
    </tr><tr>
        <td>例3</td><td>%7.5</td><td>8%</td><td>10%</td><td>0.5%</td><td>2%</td><td>优化方差</td>
    </tr>
    
</table>

**总结：**

1. 通过偏差和误差的相对大小对问题的定位；
2. 偏差和误差的相对大小，受基准误差设定的影响；
3. 先设定人工误差为基准误差，随着模型不断迭代优化，可以提高基准门槛；
4. 模型开发是一个螺旋上升的迭代过程；

# 误差分析
某类错误率较大，应该针对性的优化，否则，可以允许这种误差存在
##  建立错误分类表格，归纳错误类型
1. 分类错误类型：
    1. 假阳性-误报；
    1. 假阴性-漏报；
2. 原因错误类型：
    1. 图片模糊；
    2. 声音存在噪音；
    3. 错误标记；
    4. 数据异常；
<table>
    <tr><th>错误样本编号</th><th>$Error_1$</th><th>...</th><th>$Error_n$</th></tr>
    <tr><td>1</td><td>1</td><td></td><td></td></tr>
    <tr><td>$\vdots$</td><td></td><td></td><td></td></tr>
    <tr><td>n</td><td></td><td></td><td>1</td></tr>
    <tr><td>$\frac{sum}{n}$</td><td>a%</td><td>b%</td><td>c%</td></tr>
</table>

## 例
<img src="images/e5c7f1005d695914f4a2fc988aa46821.png">

## 误差分析是一个人工反馈的好办法
1. 能够帮助找到明确的待优化问题；
2. 加深对待解决问题和数据集的了解；
3. 手工操作在开发阶段必不可少，开发阶段更多的人工操作是为了应用阶段更少的人工干预；

# 快速搭建原型，进入迭代状态
## 原因
1. 机器学习模型可选择的功能模块很多，各模块可选择的方法很多；
2. 原则：$idea\to code\to experiment\to idea$

## 步骤
1. 简单的实现，设定单一评估指标，完成训练和测试；
2. 根据偏差和方差，选择优化方向；
3. 改进之后，从2开始迭代；
4. 提高基准门槛，从2开始迭代；


```python

```
